import{u as e,j as t,g as a,c as s}from"./index-CS3KqmWJ.js";import{r}from"./vendor-react-BJYbxeCs.js";import{a as l}from"./vendor-utils-qHW_S61q.js";import{E as d}from"./ExcuseLetterManager-Bx7T9csS.js";import{W as i}from"./WeatherAdvisory-ibqTx0ub.js";import{U as n,V as c,W as x,Y as o,Z as m,_ as h,$ as f,a0 as p,a1 as g,a4 as y,t as j}from"./vendor-ui-Cf-65S3f.js";import"./ResponsiveTable-C7m1nVKB.js";import"./useResponsive-XC39aU2L.js";const u=()=>{const{user:u}=e(),[b,N]=r.useState([]),[v,w]=r.useState(!0),[S,_]=r.useState(null),[D,k]=r.useState([]),[C,A]=r.useState({totalStaff:0,staffByRank:[],attendanceStats:[]});r.useEffect(()=>{(async()=>{if(u&&"training_staff"===u.role)try{const e=await a("dashboard","staff_history");if(e){let t=e,a=0;if(e.data&&e.timestamp&&(t=e.data,a=e.timestamp),N(t),w(!1),a&&Date.now()-a<3e5)return}const t=await l.get("/api/attendance/my-history/staff");N(t.data),await s("dashboard","staff_history",{data:t.data,timestamp:Date.now()})}catch(e){}finally{w(!1)}else w(!1)})()},[u]),r.useEffect(()=>{(async()=>{var e;if(u&&"training_staff"===u.role)try{const t=await l.get("/api/staff/me");_((null==(e=t.data)?void 0:e.role)||null)}catch{}})()},[u]);const T="Commandant"===S||"Assistant Commandant"===S||"NSTP Director"===S||"ROTC Coordinator"===S||"Admin NCO"===S;if(r.useEffect(()=>{if("Commandant"!==S&&"Assistant Commandant"!==S&&"NSTP Director"!==S&&"ROTC Coordinator"!==S&&"Admin NCO"!==S)return;(async()=>{try{const e=await a("analytics","cg_staff_list_dashboard"),t=await a("analytics","cg_staff_analytics_dashboard");e&&e.data&&Date.now()-e.timestamp<3e5&&k(e.data),t&&t.data&&Date.now()-t.timestamp<3e5&&A(t.data);const[r,d]=await Promise.allSettled([l.get("/api/staff/list"),l.get("/api/staff/analytics/overview")]);"fulfilled"===r.status&&Array.isArray(r.value.data)&&(k(r.value.data),await s("analytics","cg_staff_list_dashboard",{data:r.value.data,timestamp:Date.now()})),"fulfilled"===d.status&&d.value&&d.value.data&&(A(d.value.data),await s("analytics","cg_staff_analytics_dashboard",{data:d.value.data,timestamp:Date.now()}))}catch{}})()},[S]),v)return t.jsx("div",{className:"text-center p-10",children:"Loading..."});const R=b.filter(e=>"present"===e.status).length,E=b.filter(e=>"absent"===e.status).length,O=b.filter(e=>"excused"===e.status).length;return t.jsxs("div",{className:"space-y-8",children:[t.jsx(i,{}),t.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"My Portal"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"bg-green-50 p-6 rounded shadow border-l-4 border-green-500",children:[t.jsx("h3",{className:"text-green-800 font-bold uppercase text-sm",children:"Present"}),t.jsx("p",{className:"text-3xl font-bold mt-2",children:R}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Training Days"})]}),t.jsxs("div",{className:"bg-red-50 p-6 rounded shadow border-l-4 border-red-500",children:[t.jsx("h3",{className:"text-red-800 font-bold uppercase text-sm",children:"Absent"}),t.jsx("p",{className:"text-3xl font-bold mt-2",children:E}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Training Days"})]}),t.jsxs("div",{className:"bg-blue-50 p-6 rounded shadow border-l-4 border-blue-500",children:[t.jsx("h3",{className:"text-blue-800 font-bold uppercase text-sm",children:"Excused"}),t.jsx("p",{className:"text-3xl font-bold mt-2",children:O}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Training Days"})]})]}),T&&t.jsx("div",{children:t.jsx(d,{})}),T&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 border-t-4 border-[var(--primary-color)]",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx(n,{className:"text-[var(--primary-color)] mr-2",size:20}),t.jsx("h3",{className:"font-bold text-gray-800",children:"Training Staff Overview"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"rounded bg-gray-50 p-4 text-center",children:[t.jsx("div",{className:"text-xs text-gray-500",children:"Total Staff"}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:C.totalStaff||0})]}),t.jsxs("div",{className:"rounded bg-gray-50 p-4 text-center",children:[t.jsx("div",{className:"text-xs text-gray-500",children:"Roles"}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:new Set(D.map(e=>e.role)).size||0})]})]}),t.jsx("div",{className:"mt-4",children:t.jsx(c,{width:"100%",height:220,children:t.jsxs(x,{data:C.staffByRank||[],margin:{top:10,right:20,left:0,bottom:0},children:[t.jsx(o,{strokeDasharray:"3 3",vertical:!1}),t.jsx(m,{dataKey:"rank"}),t.jsx(h,{allowDecimals:!1}),t.jsx(f,{}),t.jsx(p,{}),t.jsx(g,{dataKey:"count",fill:"#16a34a",radius:[4,4,0,0]})]})})})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 border-t-4 border-[var(--primary-color)] md:col-span-2",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx(y,{className:"text-[var(--primary-color)] mr-2",size:20}),t.jsx("h3",{className:"font-bold text-gray-800",children:"Staff Attendance Stats"})]}),t.jsx(c,{width:"100%",height:260,children:t.jsxs(x,{data:(C.attendanceStats||[]).map(e=>({status:e.status,count:e.count})),margin:{top:10,right:20,left:0,bottom:0},children:[t.jsx(o,{strokeDasharray:"3 3",vertical:!1}),t.jsx(m,{dataKey:"status"}),t.jsx(h,{allowDecimals:!1}),t.jsx(f,{}),t.jsx(p,{}),t.jsx(g,{dataKey:"count",fill:"#2563eb",radius:[4,4,0,0]})]})})]})]}),T&&t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 border-t-4 border-[var(--primary-color)]",children:[t.jsx("div",{className:"flex justify-between items-center mb-4",children:t.jsxs("h3",{className:"font-bold text-gray-800 flex items-center",children:[t.jsx(n,{size:20,className:"text-[var(--primary-color)] mr-2"}),"Training Staff List"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-600",children:"Rank"}),t.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-600",children:"Name"}),t.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-600",children:"Role"}),t.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-600",children:"Email"}),t.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-600",children:"Contact"})]})}),t.jsxs("tbody",{className:"divide-y divide-gray-100",children:[(D||[]).slice(0,20).map(e=>t.jsxs("tr",{children:[t.jsx("td",{className:"px-4 py-2 text-gray-800",children:e.rank||"-"}),t.jsx("td",{className:"px-4 py-2 text-gray-800",children:`${e.last_name||""}, ${e.first_name||""}`}),t.jsx("td",{className:"px-4 py-2 text-gray-600",children:e.role||"-"}),t.jsx("td",{className:"px-4 py-2 text-gray-600",children:e.email||"-"}),t.jsx("td",{className:"px-4 py-2 text-gray-600",children:e.contact_number||"-"})]},e.id)),(!D||0===D.length)&&t.jsx("tr",{children:t.jsx("td",{colSpan:"5",className:"px-4 py-6 text-center text-gray-500",children:"No training staff found."})})]})]})})]}),t.jsxs("div",{className:"bg-white rounded shadow p-6",children:[t.jsxs("h2",{className:"text-xl font-bold mb-4 border-b pb-2 flex items-center",children:[t.jsx(j,{className:"mr-2",size:20}),"Attendance History"]}),0===b.length?t.jsx("p",{className:"text-gray-500 text-center py-4",children:"No attendance records found."}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Remarks"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map(e=>t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(e.date).toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"short",day:"numeric"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full \n                                                "+("present"===e.status?"bg-green-100 text-green-800":"absent"===e.status?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"),children:e.status&&"string"==typeof e.status?e.status.toUpperCase():"N/A"})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.remarks||"-"})]},e.id))})]})})]})]})};export{u as default};
