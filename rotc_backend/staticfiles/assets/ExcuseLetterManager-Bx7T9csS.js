import{d as e,e as t,j as s}from"./index-CS3KqmWJ.js";import{r as a}from"./vendor-react-BJYbxeCs.js";import{a as r}from"./vendor-utils-qHW_S61q.js";import{R as l}from"./ResponsiveTable-C7m1nVKB.js";import{a6 as n,N as o,Q as i,T as c,aE as d,D as x}from"./vendor-ui-Cf-65S3f.js";const u=()=>{const[u,m]=a.useState([]),[p,h]=a.useState(!0),[f,j]=a.useState("all");a.useEffect(()=>{v()},[]);const v=async()=>{try{try{const t=await e("excuse_letters");(null==t?void 0:t.length)&&m(t)}catch{}const s=await r.get("/api/excuse");m(s.data),await t("excuse_letters",s.data)}catch(s){}finally{h(!1)}},g=async(e,t)=>{if(window.confirm(`Are you sure you want to mark this as ${t}?`))try{await r.put(`/api/excuse/${e}`,{status:t}),v()}catch(s){alert("Failed to update status")}},b=u.filter(e=>"all"===f||e.status===f);return p?s.jsx("div",{children:"Loading excuse letters..."}):s.jsxs("div",{className:"bg-white p-6 rounded shadow",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h2",{className:"text-xl font-bold",children:"Excuse Letter Review"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(n,{size:16,className:"text-gray-500"}),s.jsxs("select",{value:f,onChange:e=>j(e.target.value),className:"border rounded p-1 text-sm",children:[s.jsx("option",{value:"all",children:"All Status"}),s.jsx("option",{value:"pending",children:"Pending"}),s.jsx("option",{value:"approved",children:"Approved"}),s.jsx("option",{value:"rejected",children:"Rejected"})]})]})]}),s.jsx(l,{data:b,columns:[{key:"cadet",label:"Cadet",render:(e,t)=>s.jsxs("span",{className:"font-medium",children:[t.last_name,", ",t.first_name]})},{key:"date_absent",label:"Date Absent",render:(e,t)=>new Date(t.date_absent).toLocaleDateString()},{key:"reason",label:"Reason",render:(e,t)=>s.jsx("div",{className:"max-w-xs truncate",title:t.reason,children:t.reason})},{key:"proof",label:"Proof",render:(e,t)=>s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsxs("a",{href:t.file_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center",children:[s.jsx(d,{size:14,className:"mr-1"})," View"]}),s.jsxs("a",{href:t.file_url,download:!0,className:"text-green-700 hover:underline flex items-center text-xs",children:[s.jsx(x,{size:12,className:"mr-1"})," Download"]})]})},{key:"status",label:"Status",render:(e,t)=>s.jsx("span",{className:"px-2 py-1 rounded text-xs font-bold uppercase "+("approved"===t.status?"bg-green-100 text-green-800":"rejected"===t.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:t.status})}],loading:p,emptyMessage:"No excuse letters found.",actions:[...b.some(e=>"pending"===e.status)?[{icon:o,label:"Approve",onClick:e=>g(e.id,"approved"),className:"text-green-600 hover:text-green-800 hover:bg-green-50"},{icon:i,label:"Reject",onClick:e=>g(e.id,"rejected"),className:"text-red-600 hover:text-red-800 hover:bg-red-50"}]:[],{icon:c,label:"Delete",onClick:e=>(async e=>{if(window.confirm("Are you sure you want to delete this excuse letter? This action cannot be undone."))try{await r.delete(`/api/excuse/${e}`),m(u.filter(t=>t.id!==e));const s=u.filter(t=>t.id!==e);await t("excuse_letters",s)}catch(s){alert("Failed to delete excuse letter")}})(e.id),className:"text-gray-500 hover:text-red-600 hover:bg-red-50"}],filterable:!0,pagination:!0,itemsPerPage:10,className:"bg-white"})]})};export{u as E};
