import{j as e}from"./index-b5aGx8Xb.js";import{r as a}from"./vendor-react-BJYbxeCs.js";import{a as r}from"./vendor-utils-qHW_S61q.js";import{n as t,aw as s}from"./vendor-ui-Cf-65S3f.js";import{H as d}from"./vendor-media-Cvam96dz.js";const n=()=>{var n,l,o;const[i,c]=a.useState(null),[m,x]=a.useState([]),[f,u]=a.useState(""),[g,h]=a.useState(null),[y,v]=a.useState(null),[b,p]=a.useState(!1),j=a.useRef(null);a.useEffect(()=>{w()},[]);const w=async()=>{try{const e=localStorage.getItem("token"),a=await r.get("/api/attendance/days",{headers:{Authorization:`Bearer ${e}`}});if(x(a.data),a.data.length>0){const e=(new Date).toISOString().split("T")[0],r=a.data.find(a=>a.date===e);u(r?r.id:a.data[0].id)}}catch(e){t.error("Failed to load training days")}};a.useEffect(()=>{if(!f)return;j.current&&(j.current.clear().catch(()=>{}),j.current=null);const e=new d("staff-qr-reader",{fps:10,qrbox:{width:250,height:250}},!1);return e.render(e=>{if(e&&!b)try{const a=JSON.parse(e);if(!a.id)return void t.error("Invalid staff QR code");h(e),v({name:a.name||"",afpsn:a.afpsn||""}),p(!0),navigator.vibrate&&navigator.vibrate(40)}catch(a){t.error("Invalid QR Code format")}},()=>{}),j.current=e,()=>{j.current&&(j.current.clear().catch(()=>{}),j.current=null)}},[f]);const N=async e=>{var a,s;if(g&&f)try{const a=localStorage.getItem("token"),s=await r.post("/api/attendance/staff/scan",{dayId:f,qrData:g,status:e},{headers:{Authorization:`Bearer ${a}`}});c(s.data),p(!1),h(null),t.success(`Staff marked as ${e}`),navigator.vibrate&&navigator.vibrate(60)}catch(d){const e=(null==(s=null==(a=d.response)?void 0:a.data)?void 0:s.message)||"Failed to record staff attendance";t.error(e)}};return e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-[var(--primary-color)]",children:"Staff QR Attendance Scanner"}),e.jsx("p",{className:"mb-4 text-gray-600 dark:text-gray-300",children:"Scan each training staff's unique QR code to record their attendance."}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Select Training Day"}),e.jsxs("select",{value:f,onChange:e=>u(e.target.value),className:"w-full md:w-1/3 p-2 border rounded shadow-sm bg-white dark:bg-gray-900 border-gray-300 dark:border-gray-700 text-gray-900 dark:text-gray-100 focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)]",children:[e.jsx("option",{value:"",children:"-- Select Day --"}),m.map(a=>e.jsxs("option",{value:a.id,children:[a.date," - ",a.title]},a.id))]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsxs("div",{className:"w-full md:w-1/2 bg-white dark:bg-gray-900 p-4 rounded shadow",children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-[var(--primary-color-soft)] text-[var(--primary-color)]",children:e.jsx(s,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-800 dark:text-gray-100",children:"Live QR Scanner"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Point the camera at the staff QR code."})]})]}),e.jsx("div",{id:"staff-qr-reader",className:"w-full rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700"})]}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-gray-800 dark:text-gray-100",children:"Last Scan Result"}),b&&e.jsxs("div",{className:"mb-4 p-4 bg-[var(--primary-color-soft)] border border-[var(--primary-color)] rounded",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-800 dark:text-gray-100 mb-2",children:[(null==y?void 0:y.name)||"Scanned staff"," ",(null==y?void 0:y.afpsn)?`(${y.afpsn})`:""]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 mb-3",children:"Choose attendance status. First scan records time in (7:30–9:00 window), second scan records time out (11:30–12:00)."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>N("present"),className:"px-3 py-1.5 text-xs font-semibold rounded bg-[var(--primary-color)] text-white hover:bg-teal-800",children:"Present"}),e.jsx("button",{onClick:()=>N("absent"),className:"px-3 py-1.5 text-xs font-semibold rounded bg-red-100 text-red-700 hover:bg-red-200",children:"Absent"}),e.jsx("button",{onClick:()=>N("excused"),className:"px-3 py-1.5 text-xs font-semibold rounded bg-yellow-100 text-yellow-800 hover:bg-yellow-200",children:"Excused"})]})]}),i?e.jsxs("div",{className:"p-6 bg-white dark:bg-gray-900 border-l-4 border-[var(--primary-color)] rounded shadow animate-pulse-once",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"text-xl font-bold text-gray-800 dark:text-gray-100",children:(null==(n=i.staff)?void 0:n.name)||(null==(l=i.staff)?void 0:l.last_name)}),e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded bg-[var(--primary-color-soft)] text-[var(--primary-color)]",children:null==(o=i.status)?void 0:o.toUpperCase()})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-300 mt-2",children:i.message})]}):e.jsx("div",{className:"p-6 bg-gray-50 dark:bg-gray-800 border rounded text-center text-gray-500 dark:text-gray-300",children:"Waiting for scan..."})]})]}),e.jsx("style",{children:"\n              #staff-qr-reader { min-height: 320px; }\n              @media (min-width: 640px) { #staff-qr-reader { min-height: 380px; } }\n            "})]})};export{n as default};
