import{u as e,g as a,c as s,j as t}from"./index-b5aGx8Xb.js";import{u as l,r as i}from"./vendor-react-BJYbxeCs.js";import{a as r}from"./vendor-utils-qHW_S61q.js";import{n,X as o,an as c,L as d,ag as m,b as u,a2 as p,a as x,t as g,v as f,aL as h,aM as b,aN as j,S as v,aO as N,o as y,k as w,O as _,j as k}from"./vendor-ui-Cf-65S3f.js";import{a as C}from"./image-CT_PXJmf.js";const S=["MSU-SND ROTC UNIT"],z=["1002nd CDC","10th RCDG","RCPA"],P=["Filipino","Others"],A=["Male","Female"],R=["Single","Married","Widowed"],L=["A+","A-","B+","B-","AB+","AB-","O+","O-"],F=["Tagalog","Cebuano","Meranao","English"],D=["5R","5W","6R","6W","7R","7W","8R","8W","9R","9W","10R","10W","11R","11W","12R","12W"],E=["Small Short","Small Regular","Small Long","Medium Short","Medium Regular","Medium Long","Large Short","Large Regular","Large Long"],U=["56","57","58","59","60"];Array.from({length:48},(e,a)=>(a+18).toString());const M=({icon:e,label:a,value:s,name:l,type:i="text",options:r=null,multi:n=!1,isEditing:o,formData:c,handleInputChange:d,toggleLanguage:m})=>t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1 mb-1",children:[e&&t.jsx(e,{size:12})," ",a]}),o?r?n?t.jsx("div",{className:"flex flex-wrap gap-2 p-2 border border-gray-300 rounded bg-white",children:r.map(e=>t.jsx("button",{type:"button",onClick:()=>m(e),className:"px-2 py-1 text-xs rounded-full border "+((c[l]||"").includes(e)?"bg-green-600 text-white border-green-600":"bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200"),children:e},e))}):t.jsxs("select",{name:l,value:c[l]||"",onChange:d,className:"border border-gray-300 rounded px-2 py-1 text-sm w-full focus:outline-none focus:border-green-500 bg-white",children:[t.jsxs("option",{value:"",children:["Select ",a]}),r.map(e=>t.jsx("option",{value:e,children:e},e))]}):t.jsx("input",{type:i,name:l,value:c[l]||"",onChange:d,className:"border border-gray-300 rounded px-2 py-1 text-sm w-full focus:outline-none focus:border-green-500",placeholder:a}):t.jsx("span",{className:"font-medium text-gray-900 break-words",children:s||"-"})]}),T=()=>{const{logout:T}=e(),W=l(),[B,I]=i.useState(null),[O,q]=i.useState(!0),[Y,G]=i.useState(""),[$,H]=i.useState(!1),[J,K]=i.useState({}),[Q,V]=i.useState(null),X=i.useRef(null),[Z,ee]=i.useState(!1);i.useEffect(()=>{ae()},[]);const ae=async()=>{try{const e=await a("profiles","staff");if(e){let a=e,s=0;e.data&&e.timestamp&&(a=e.data,s=e.timestamp),I(a),K(a);const t=C(a.profile_pic,a.id,"staff");if(V(t),q(!1),s&&Date.now()-s<3e5)return}const t=await r.get("/api/staff/me");I(t.data),K(t.data);const l=C(t.data.profile_pic,t.data.id,"staff");V(l),q(!1),await s("profiles","staff",{data:t.data,timestamp:Date.now()}),t.data.is_profile_completed||(H(!0),n("Please complete your profile information.",{icon:"ℹ️"}))}catch(e){B||(G("Failed to load profile data."),q(!1))}},se=e=>{const{name:a,value:s}=e.target;K(e=>({...e,[a]:s}))},te=async e=>{var a,t;e.preventDefault();const l=["first_name","last_name","afpsn","address","contact_number","email","birthdate","gender"].filter(e=>!J[e]);if(l.length>0)n.error(`Please fill in required fields: ${l.join(", ")}`);else try{let e=!0===J.is_profile_completed||"true"===J.is_profile_completed||1===J.is_profile_completed||"1"===J.is_profile_completed;if(B.is_profile_completed||(e=!0,J.is_profile_completed=!0),e&&!B.is_profile_completed&&!window.confirm("Saving your profile will complete the setup and log you out. You will need to login again with your Email. Continue?"))return;await r.put("/api/staff/profile",J);if(e&&!B.is_profile_completed)n.success("Profile setup complete! Your username has been updated to your Email. Please login again using your Email.",{duration:5e3}),setTimeout(()=>{T(),W("/login")},3e3);else{const e={...B,...J};I(e),await s("profiles","staff",{data:e,timestamp:Date.now()}),H(!1),n.success("Profile updated successfully")}}catch(i){n.error((null==(t=null==(a=i.response)?void 0:a.data)?void 0:t.message)||"Failed to update profile")}};if(O)return t.jsx("div",{className:"p-8 text-center",children:"Loading profile..."});if(Y)return t.jsx("div",{className:"p-8 text-center text-red-600",children:Y});if(!B)return t.jsx("div",{className:"p-8 text-center",children:"No profile found."});const le={isEditing:$,formData:J,handleInputChange:se,toggleLanguage:e=>{const a=J.language_spoken?J.language_spoken.split(", ").filter(e=>e):[];let s;s=a.includes(e)?a.filter(a=>a!==e):[...a,e],K(e=>({...e,language_spoken:s.join(", ")}))}};return t.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[t.jsx("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden border border-gray-200",children:t.jsxs("div",{className:"bg-gradient-to-r from-green-800 to-green-900 p-6 text-white relative",children:[t.jsx("div",{className:"absolute top-4 right-4 flex gap-2",children:$?t.jsx(t.Fragment,{children:t.jsx("button",{onClick:()=>H(!1),className:"bg-red-500/80 hover:bg-red-600 text-white p-2 rounded-full backdrop-blur-sm transition-colors",title:"Cancel",children:t.jsx(o,{size:20})})}):B.is_profile_completed?t.jsx("div",{className:"bg-white/20 backdrop-blur-sm p-2 rounded-full",title:"Profile Locked",children:t.jsx(d,{size:20,className:"text-white"})}):t.jsx("button",{onClick:()=>H(!0),className:"bg-white/20 hover:bg-white/30 text-white p-2 rounded-full backdrop-blur-sm transition-colors",title:"Edit Profile",children:t.jsx(c,{size:20})})}),t.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-8",children:[t.jsxs("div",{className:"relative group",children:[t.jsxs("div",{className:"w-40 h-40 rounded-full bg-white/10 border-4 border-white overflow-hidden flex items-center justify-center shadow-xl relative",children:[t.jsx("img",{src:Q,alt:"Profile",className:"w-full h-full object-cover",onError:e=>{e.target.src=`/api/images/staff/profile/${B.id}`}}),t.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",onClick:()=>ee(!0),children:t.jsx(m,{className:"text-white",size:32})})]}),t.jsx("input",{type:"file",ref:X,className:"hidden",accept:"image/*",onChange:async e=>{const a=e.target.files[0];if(!a)return;const t=new FormData;t.append("image",a);try{const e=n.loading("Uploading profile picture..."),a=await r.post("/api/staff/profile/photo",t,{headers:{"Content-Type":"multipart/form-data"}});n.dismiss(e),n.success("Profile picture updated");const l={...B,profile_pic:a.data.filePath};I(l),K(e=>({...e,profile_pic:a.data.filePath}));const i=C(a.data.filePath,B.id,"staff");V(i),await s("profiles","staff",{data:l,timestamp:Date.now()})}catch(l){n.error("Failed to upload image")}}})]}),t.jsxs("div",{className:"text-center md:text-left flex-1 w-full",children:[$?t.jsxs("div",{className:"space-y-3 text-gray-800 bg-white/10 p-4 rounded-lg backdrop-blur-sm",children:[t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("input",{name:"rank",value:J.rank||"",onChange:se,placeholder:"Rank",className:"p-1 rounded w-20"}),t.jsx("input",{name:"first_name",value:J.first_name||"",onChange:se,placeholder:"First Name",className:"p-1 rounded flex-1"}),t.jsx("input",{name:"last_name",value:J.last_name||"",onChange:se,placeholder:"Last Name",className:"p-1 rounded flex-1"}),t.jsx("input",{name:"suffix_name",value:J.suffix_name||"",onChange:se,placeholder:"Suffix",className:"p-1 rounded w-20"})]}),t.jsx("div",{className:"flex gap-2",children:t.jsx("input",{name:"afpsn",value:J.afpsn||"",onChange:se,placeholder:"AFPSN",className:"p-1 rounded w-full"})}),t.jsx("div",{className:"flex gap-2",children:t.jsx("input",{name:"username",value:J.username||"",onChange:se,placeholder:"Username",className:"p-1 rounded w-full bg-yellow-50",disabled:!0,title:"Username will be updated to Email upon save"})}),!B.is_profile_completed&&t.jsx("div",{className:"mt-2 bg-blue-600/50 p-2 rounded text-xs text-white",children:t.jsx("p",{children:"Completing this profile will update your username to your email address and require a re-login."})})]}):t.jsxs(t.Fragment,{children:[t.jsxs("h1",{className:"text-3xl font-bold",children:[B.rank," ",B.first_name," ",B.middle_name," ",B.last_name," ",B.suffix_name]}),t.jsxs("p",{className:"text-green-200 text-lg mt-1",children:[B.afpsn||"No AFPSN"," | ",B.role||"Training Staff"]}),t.jsxs("p",{className:"text-green-300 text-sm",children:["@",B.username||"username"]})]}),t.jsxs("div",{className:"mt-4 flex flex-wrap gap-2 justify-center md:justify-start",children:[t.jsxs("div",{className:"px-3 py-1 rounded-full bg-green-700/50 text-sm border border-green-600 flex items-center",children:[t.jsx(u,{size:14,className:"mr-2"}),$?t.jsxs("select",{name:"rotc_unit",value:J.rotc_unit||"",onChange:se,className:"bg-transparent border-none text-white w-full focus:outline-none appearance-none",children:[t.jsx("option",{value:"",className:"text-black",children:"Select Unit"}),S.map(e=>t.jsx("option",{value:e,className:"text-black",children:e},e))]}):B.rotc_unit||"No Unit"]}),t.jsxs("div",{className:"px-3 py-1 rounded-full bg-green-700/50 text-sm border border-green-600 flex items-center",children:[t.jsx(p,{size:14,className:"mr-2"}),$?t.jsxs("select",{name:"mobilization_center",value:J.mobilization_center||"",onChange:se,className:"bg-transparent border-none text-white w-full focus:outline-none appearance-none",children:[t.jsx("option",{value:"",className:"text-black",children:"Select Center"}),z.map(e=>t.jsx("option",{value:e,className:"text-black",children:e},e))]}):B.mobilization_center||"No Center"]})]})]})]})]})}),t.jsxs("form",{onSubmit:te,children:[t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[t.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 border-b pb-2 flex items-center text-green-800",children:[t.jsx(x,{className:"mr-2",size:20})," Personal Information"]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-y-6 gap-x-4",children:[t.jsx(M,{...le,icon:g,label:"Birthdate",value:B.birthdate,name:"birthdate",type:"date"}),t.jsx(M,{...le,icon:p,label:"Birthplace",value:B.birthplace,name:"birthplace"}),t.jsx(M,{...le,icon:f,label:"Age",value:B.age,name:"age",type:"number"}),t.jsx(M,{...le,icon:h,label:"Nationality",value:B.nationality,name:"nationality",options:P}),t.jsx(M,{...le,icon:x,label:"Gender",value:B.gender,name:"gender",options:A}),t.jsx(M,{...le,icon:x,label:"Civil Status",value:B.civil_status,name:"civil_status",options:R}),t.jsx(M,{...le,icon:b,label:"Height (cm)",value:B.height,name:"height"}),t.jsx(M,{...le,icon:f,label:"Weight (kg)",value:B.weight,name:"weight"}),t.jsx(M,{...le,icon:f,label:"Blood Type",value:B.blood_type,name:"blood_type",options:L}),t.jsx("div",{className:"col-span-2 md:col-span-3",children:t.jsx(M,{...le,icon:j,label:"Language Spoken",value:B.language_spoken,name:"language_spoken",options:F,multi:!0})})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[t.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 border-b pb-2 flex items-center text-green-800",children:[t.jsx(v,{className:"mr-2",size:20})," Logistics & Sizes"]}),t.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[t.jsx(M,{...le,label:"Combat Boots",value:B.combat_boots_size,name:"combat_boots_size",options:D}),t.jsx(M,{...le,label:"Uniform Size",value:B.uniform_size,name:"uniform_size",options:E}),t.jsx(M,{...le,label:"Bullcap Size",value:B.bullcap_size,name:"bullcap_size",options:U})]})]})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[t.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 border-b pb-2 flex items-center text-green-800",children:[t.jsx(N,{className:"mr-2",size:20})," Contact Information"]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(M,{...le,icon:p,label:"Address",value:B.address,name:"address"}),t.jsx(M,{...le,icon:y,label:"Email Address",value:B.email,name:"email",type:"email"}),t.jsx(M,{...le,icon:N,label:"Mobile Number",value:B.contact_number,name:"contact_number"}),t.jsx(M,{...le,icon:w,label:"Facebook",value:B.facebook_link,name:"facebook_link"})]})]}),B.is_profile_completed&&!$&&t.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4",children:t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(d,{className:"h-5 w-5 text-yellow-400","aria-hidden":"true"})}),t.jsx("div",{className:"ml-3",children:t.jsx("p",{className:"text-sm text-yellow-700",children:"Profile is locked. Contact admin for changes."})})]})}),!B.is_profile_completed&&!$&&t.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4",children:t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(_,{className:"h-5 w-5 text-red-400","aria-hidden":"true"})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("p",{className:"text-sm text-red-700 font-bold",children:"Action Required"}),t.jsx("p",{className:"text-sm text-red-700 mt-1",children:"You must complete your profile information to access the Training Staff Portal features."}),t.jsx("button",{onClick:()=>H(!0),className:"mt-2 text-sm font-medium text-red-600 hover:text-red-500 underline",children:"Update Profile Now"})]})]})})]})]}),$&&t.jsx("div",{className:"flex justify-end mt-6",children:t.jsxs("button",{onClick:te,className:"bg-green-700 hover:bg-green-800 text-white px-4 py-2 rounded-md shadow flex items-center text-sm font-semibold transition-transform transform hover:scale-105",title:"Save Changes",children:[t.jsx(k,{size:24,className:"mr-2"}),"Save Profile"]})})]}),Z&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[t.jsx("h4",{className:"text-lg font-bold text-gray-800 mb-2",children:"Allow Camera or Files Access"}),t.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"To update your profile picture, choose whether to use your camera or select from your gallery/files."}),t.jsxs("div",{className:"flex justify-end gap-3",children:[t.jsx("button",{type:"button",onClick:()=>ee(!1),className:"px-4 py-2 text-sm rounded border border-gray-300 text-gray-700 hover:bg-gray-50",children:"Cancel"}),t.jsx("button",{type:"button",onClick:async()=>{var e,a,s,t;try{if(null==(e=navigator.mediaDevices)?void 0:e.getUserMedia){const e=await navigator.mediaDevices.getUserMedia({video:!0});try{e.getTracks().forEach(e=>e.stop())}catch{}}}catch{}try{null==(a=X.current)||a.setAttribute("accept","image/*"),null==(s=X.current)||s.setAttribute("capture","environment"),null==(t=X.current)||t.click()}catch{}ee(!1)},className:"px-4 py-2 text-sm rounded bg-blue-600 text-white hover:bg-blue-700",children:"Use Camera"}),t.jsx("button",{type:"button",onClick:()=>{var e,a,s;try{null==(e=X.current)||e.setAttribute("accept","image/*"),null==(a=X.current)||a.removeAttribute("capture"),null==(s=X.current)||s.click()}catch{}ee(!1)},className:"px-4 py-2 text-sm rounded bg-green-700 text-white hover:bg-green-800",children:"Choose Files"})]})]})})]})};export{T as default};
