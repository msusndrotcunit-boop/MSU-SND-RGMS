import{j as e,g as a,c as t}from"./index-b5aGx8Xb.js";import{r as s}from"./vendor-react-BJYbxeCs.js";import{a as i}from"./vendor-utils-qHW_S61q.js";import{aF as r,a2 as n,aG as l,aH as o,ae as c,aI as d}from"./vendor-ui-Cf-65S3f.js";const m=()=>{const[m,u]=s.useState(null),[h,x]=s.useState(!0),[g,p]=s.useState(null),[y,w]=s.useState("Sultan Naga Dimaporo"),[j,v]=s.useState(!1),f=123.736,b="weather_data",N=36e5;s.useEffect(()=>{(async()=>{try{const e=await a("analytics",b);e&&Date.now()-e.timestamp<N&&(u(e.data),w(e.locationName),v(e.isUsingCurrentLocation),x(!1))}catch(e){}D()})()},[]);const _=async(e,a,s,r)=>{try{const n=(await i.get(`https://api.open-meteo.com/v1/forecast?latitude=${e}&longitude=${a}&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia%2FManila`)).data;u(n),x(!1),await t("analytics",b,{data:n,locationName:s,isUsingCurrentLocation:r,lat:e,lon:a,timestamp:Date.now()})}catch(n){m||p("Unable to load weather data."),x(!1)}},z=async(e,a)=>{try{const t=await i.get(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${a}`);if(t.data&&t.data.address){const{city:e,town:a,village:s,municipality:i,county:r,state:n}=t.data.address,l=e||a||s||i||r;if(l)return`${l}${n?`, ${n}`:""}`}}catch(t){}return"Sultan Naga Dimaporo"},D=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(async e=>{const{latitude:t,longitude:s}=e.coords;try{const e=await a("analytics",b);if(e&&Math.abs(e.lat-t)<.01&&Math.abs(e.lon-s)<.01&&Date.now()-e.timestamp<N)return u(e.data),w(e.locationName),v(!0),void x(!1)}catch(n){}v(!0);try{await i.post("/api/auth/location",{latitude:t,longitude:s})}catch(n){}const r=await z(t,s);w(r),_(t,s,r,!0)},async e=>{var t,s,r;try{const e=await i.get("https://ipapi.co/json/"),l=null==(t=e.data)?void 0:t.latitude,o=null==(s=e.data)?void 0:s.longitude,c=null==(r=e.data)?void 0:r.city;if(l&&o){try{const e=await a("analytics",b);if(e&&Math.abs(e.lat-l)<.01&&Math.abs(e.lon-o)<.01&&Date.now()-e.timestamp<N)return}catch(n){}const e=c||await z(l,o);return v(!1),w(e),_(l,o,e,!1)}}catch(l){}_(7.808,f,"Sultan Naga Dimaporo",!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5}):_(7.808,f,"Sultan Naga Dimaporo",!1)};if(h)return e.jsx("div",{className:"bg-white p-4 rounded-lg shadow animate-pulse h-32 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-400",children:"Loading Weather..."})});if(g)return null;const M=null==m?void 0:m.current;return M?e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 text-white p-4 rounded-lg shadow-lg relative overflow-hidden mb-6",children:[e.jsx("div",{className:`weather-bg ${(e=>{if(!e)return"";const a=e.weather_code,t=e.wind_speed_10m||0;return a<=1?"weather-sunny":a>=51&&a<=67||a>=80&&a<=99?"weather-rain":t>=25?"weather-wind":""})(M)}`}),e.jsx("div",{className:"absolute inset-0 bg-black/10 pointer-events-none"}),e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:e.jsx(r,{size:100})}),e.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-full backdrop-blur-sm shadow-inner",children:(S=M.weather_code,0===S||1===S?e.jsx(c,{className:"text-yellow-500",size:32}):2===S||3===S?e.jsx(r,{className:"text-gray-400",size:32}):S>=51&&S<=67?e.jsx(d,{className:"text-blue-400",size:32}):S>=80&&S<=99?e.jsx(d,{className:"text-blue-600",size:32}):e.jsx(r,{className:"text-gray-400",size:32}))}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[(e=>e<=1?"Sunny Day":e<=3?"Cloudy Day":e>=51?"Rainy Day":"Cloudy Day")(M.weather_code),e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded flex items-center gap-1 "+(j?"bg-green-500/80 text-white":"bg-blue-900/50 text-blue-100"),children:[e.jsx(n,{size:10}),y]})]}),e.jsx("p",{className:"text-blue-100 text-sm",children:(e=>({0:"Clear sky",1:"Mainly clear",2:"Partly cloudy",3:"Overcast",45:"Fog",48:"Depositing rime fog",51:"Light drizzle",53:"Moderate drizzle",55:"Dense drizzle",61:"Slight rain",63:"Moderate rain",65:"Heavy rain",80:"Slight rain showers",81:"Moderate rain showers",82:"Violent rain showers",71:"Thunderstorm",95:"Thunderstorm",96:"Thunderstorm with slight hail",99:"Thunderstorm with heavy hail"}[e]||"Variable"))(M.weather_code)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-4xl font-bold flex items-center justify-end",children:[Math.round(M.temperature_2m),"°C"]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(l,{size:14}),M.wind_speed_10m," km/h"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(o,{size:14}),"H: ",Math.round(m.daily.temperature_2m_max[0]),"° L: ",Math.round(m.daily.temperature_2m_min[0]),"°"]})]})]})]})]}):null;var S};export{m as W};
