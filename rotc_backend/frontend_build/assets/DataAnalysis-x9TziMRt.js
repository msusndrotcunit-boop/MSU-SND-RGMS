import{j as e,g as a,c as s}from"./index-Df_F6O4f.js";import{r as t,L as l}from"./vendor-react-BJYbxeCs.js";import{a as n}from"./vendor-utils-qHW_S61q.js";import"./jspdf.plugin.autotable-CyGD71Xi.js";import{h as i}from"./vendor-media-Cvam96dz.js";import{aq as d,D as c,V as r,ar as o,as as h,at as x,a0 as m,$ as g,W as j,Y as b,Z as u,_ as p,a1 as v,a3 as y}from"./vendor-ui-Cf-65S3f.js";const f={MS1:"#3b82f6",MS2:"#2563eb",MS31:"#ef4444",MS32:"#dc2626",MS41:"#f59e0b",MS42:"#d97706",Basic:"#1e40af",Advance:"#b91c1c",Completed:"#22c55e",Incomplete:"#6b7280"},w=Math.PI/180,N=({cx:a,cy:s,midAngle:t,innerRadius:l,outerRadius:n,percent:i,index:d,name:c,value:r})=>{const o=l+.5*(n-l),h=a+o*Math.cos(-t*w),x=s+o*Math.sin(-t*w),m=(c||"").length>12?`${(c||"").slice(0,12)}â€¦`:c||"";return i>0?e.jsx("text",{x:h,y:x,fill:"white",textAnchor:h>a?"start":"end",dominantBaseline:"central",fontSize:10,fontWeight:"bold",children:`${m}: ${r} (${(100*i).toFixed(0)}%)`}):null},S=()=>{const[w,S]=t.useState(!0),[M,C]=t.useState({ongoing:{basic:{MS1:0,MS2:0,total:0},advance:{MS31:0,MS32:0,MS41:0,MS42:0,total:0},total:0},completed:{basic:{total:0},advance:{total:0},total:0},incomplete:{basic:{total:0},advance:{total:0},total:0}}),[D,O]=t.useState([]),[A,T]=t.useState([]),[E,k]=t.useState([]),[R,I]=t.useState([]),B=async()=>{try{const e=await a("analytics","data_analysis");if(e&&e.timestamp&&Date.now()-e.timestamp<3e5)return L(e.data),void S(!1);const t=await n.get("/api/admin/analytics");t.data&&(await s("analytics","data_analysis",{data:t.data,timestamp:Date.now()}),L(t.data))}catch(e){}finally{S(!1)}},L=e=>{var a,s,t;const l=(null==(a=e.demographics)?void 0:a.courseStats)||[],n=(null==(s=e.demographics)?void 0:s.genderByCourse)||[],i=(null==(t=e.demographics)?void 0:t.courseTotals)||[],d={ongoing:{basic:{MS1:0,MS2:0,total:0},advance:{MS31:0,MS32:0,MS41:0,MS42:0,total:0},total:0},completed:{basic:{total:0},advance:{total:0},total:0},incomplete:{basic:{total:0},advance:{total:0},total:0}};l.forEach(e=>{const a=(e=>{if(!e)return"Unknown";const a=e.toUpperCase();return["ONGOING","ENROLLED","ACTIVE"].includes(a)?"Ongoing":["COMPLETED","GRADUATED","PASSED"].includes(a)?"Completed":["INC","INCOMPLETE","T","DO"].includes(a)?"Incomplete":["FAILED","FAIL"].includes(a)?"Failed":["DROP","DROPPED"].includes(a)?"Drop":"Ongoing"})(e.status),s=(e.cadet_course||"").toUpperCase(),t=parseInt(e.count,10)||0,l=["MS1","MS2"].includes(s),n=["MS31","MS32","MS41","MS42"].includes(s);"Ongoing"===a?(l?(d.ongoing.basic[s]=(d.ongoing.basic[s]||0)+t,d.ongoing.basic.total+=t):n&&(d.ongoing.advance[s]=(d.ongoing.advance[s]||0)+t,d.ongoing.advance.total+=t),d.ongoing.total+=t):"Completed"===a?(l&&(d.completed.basic.total+=t),n&&(d.completed.advance.total+=t),d.completed.total+=t):"Incomplete"===a&&(l&&(d.incomplete.basic.total+=t),n&&(d.incomplete.advance.total+=t),d.incomplete.total+=t)}),C(d);const c={};n.forEach(e=>{const a=(e.cadet_course||"Unknown").toUpperCase(),s=e.gender||"Unknown",t=parseInt(e.count,10)||0;c[a]||(c[a]={name:a,Male:0,Female:0,Unknown:0}),"Male"===s?c[a].Male+=t:"Female"===s?c[a].Female+=t:c[a].Unknown+=t}),O(Object.values(c));const r=["COQC","MS1","MS2","MS31","MS32","MS41","MS42"],o=Object.fromEntries(r.map(e=>[e,0]));i.forEach(e=>{const a=(e.cadet_course||"").toUpperCase(),s=parseInt(e.count,10)||0;r.includes(a)&&(o[a]=s)});const h=r.map(e=>({name:e,value:o[e]}));T(h)};t.useEffect(()=>{B(),(async()=>{var e,a;try{const s=await n.get("/api/admin/analytics/demographics"),t=((null==(e=s.data)?void 0:e.religion)||[]).map(e=>({name:e.religion,value:e.count})),l=((null==(a=s.data)?void 0:a.age)||[]).map(e=>({name:e.age_range,value:e.count}));k(t),I(l)}catch(s){}})()},[]),t.useEffect(()=>{let e;const a=()=>{try{e=new EventSource("/api/attendance/events"),e.onmessage=e=>{try{const a=JSON.parse(e.data||"{}");new Set(["attendance_updated","grade_updated","staff_attendance_updated"]).has(a.type)&&B()}catch{}},e.onerror=()=>{try{e&&e.close()}catch{}setTimeout(a,3e3)}}catch{}};return a(),()=>{try{e&&e.close()}catch{}}},[]);const U=async(e,a)=>{const s=document.getElementById(e);if(s)try{const e=await i(s),t=document.createElement("a");t.download=`${a.replace(/\s+/g,"_")}_${(new Date).toISOString().split("T")[0]}.png`,t.href=e.toDataURL(),t.click()}catch(t){}},K=async e=>{const a=document.getElementById(e);if(a)try{const e=await i(a),s=`\n                <!DOCTYPE html>\n                <html>\n                <head><title>Print Chart</title></head>\n                <body onload="window.print();window.close()">\n                    <img src="${e.toDataURL("image/png")}" style="width:100%;">\n                </body>\n                </html>\n            `,t=window.open("","","width=800,height=600");t.document.write(s),t.document.close()}catch(s){}},$=[{name:"MS1",value:M.ongoing.basic.MS1},{name:"MS2",value:M.ongoing.basic.MS2}].filter(e=>e.value>0),_=[{name:"MS31",value:M.ongoing.advance.MS31},{name:"MS32",value:M.ongoing.advance.MS32},{name:"MS41",value:M.ongoing.advance.MS41},{name:"MS42",value:M.ongoing.advance.MS42}].filter(e=>e.value>0),z=[{name:"Basic",value:M.ongoing.basic.total},{name:"Advance",value:M.ongoing.advance.total}].filter(e=>e.value>0),F=[{name:"Basic",value:M.completed.basic.total},{name:"Advance",value:M.completed.advance.total}].filter(e=>e.value>0),P=[{name:"Basic",value:M.incomplete.basic.total},{name:"Advance",value:M.incomplete.advance.total}].filter(e=>e.value>0),G=({active:a,payload:s})=>a&&s&&s.length?e.jsx("div",{className:"bg-white p-2 border border-gray-200 shadow-md rounded text-sm",children:e.jsx("p",{className:"font-semibold",style:{color:s[0].fill},children:`${s[0].name}: ${s[0].value}`})}):null;return e.jsxs("div",{className:"p-4 md:p-6 min-h-screen bg-gray-50 font-sans",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md mb-6 overflow-hidden border-t-4 border-yellow-500",children:[e.jsx("div",{className:"bg-gray-900 px-6 py-3",children:e.jsx("h2",{className:"text-white font-bold",children:"Selected Details"})}),e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:"Mindanao State University-Sultan Naga Dimaporo"}),e.jsx("p",{className:"text-gray-500",children:"ROTC Unit Data Analysis"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{id:"chart-basic",className:"bg-white rounded-lg shadow-md border-t-4 border-blue-900",children:[e.jsxs("div",{className:"bg-gray-900 px-4 py-3 flex justify-between items-center",children:[e.jsx("h3",{className:"text-white font-bold",children:"Ongoing Basic ROTC Cadets"}),e.jsxs("div",{className:"space-x-2 text-gray-400",children:[e.jsx("button",{onClick:()=>K("chart-basic"),className:"hover:text-white transition-colors",children:e.jsx(d,{size:16})}),e.jsx("button",{onClick:()=>U("chart-basic","Basic ROTC Chart"),className:"hover:text-white transition-colors",children:e.jsx(c,{size:16})})]})]}),e.jsx("div",{className:"p-4 h-64",children:e.jsx(r,{width:"100%",height:"100%",children:e.jsxs(o,{children:[e.jsx(h,{data:$.length>0?$:[{name:"No Data",value:1}],cx:"50%",cy:"50%",labelLine:!1,label:N,outerRadius:80,fill:"#8884d8",dataKey:"value",children:$.length>0?$.map((a,s)=>e.jsx(x,{fill:f[a.name]||"#ccc"},`cell-${s}`)):e.jsx(x,{fill:"#eee"})}),e.jsx(m,{layout:"vertical",verticalAlign:"middle",align:"right"}),e.jsx(g,{content:e.jsx(G,{})})]})})})]}),e.jsxs("div",{id:"chart-advance",className:"bg-white rounded-lg shadow-md border-t-4 border-blue-900",children:[e.jsxs("div",{className:"bg-gray-900 px-4 py-3 flex justify-between items-center",children:[e.jsx("h3",{className:"text-white font-bold",children:"Ongoing Advance ROTC Cadets"}),e.jsxs("div",{className:"space-x-2 text-gray-400",children:[e.jsx("button",{onClick:()=>K("chart-advance"),className:"hover:text-white transition-colors",children:e.jsx(d,{size:16})}),e.jsx("button",{onClick:()=>U("chart-advance","Advance ROTC Chart"),className:"hover:text-white transition-colors",children:e.jsx(c,{size:16})})]})]}),e.jsx("div",{className:"p-4 h-64",children:e.jsx(r,{width:"100%",height:"100%",children:e.jsxs(o,{children:[e.jsx(h,{data:_.length>0?_:[{name:"No Data",value:1}],cx:"50%",cy:"50%",labelLine:!1,label:N,outerRadius:80,fill:"#8884d8",dataKey:"value",children:_.length>0?_.map((a,s)=>e.jsx(x,{fill:f[a.name]||"#ccc"},`cell-${s}`)):e.jsx(x,{fill:"#eee"})}),e.jsx(m,{layout:"vertical",verticalAlign:"middle",align:"right"}),e.jsx(g,{content:e.jsx(G,{})})]})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{id:"chart-combined",className:"bg-white rounded-lg shadow-md border-t-4 border-blue-900",children:[e.jsxs("div",{className:"bg-gray-900 px-4 py-3 flex justify-between items-center",children:[e.jsx("h3",{className:"text-white font-bold",children:"Ongoing Basic and Advance ROTC Cadets"}),e.jsxs("div",{className:"space-x-2 text-gray-400",children:[e.jsx("button",{onClick:()=>K("chart-combined"),className:"hover:text-white transition-colors",children:e.jsx(d,{size:16})}),e.jsx("button",{onClick:()=>U("chart-combined","Combined ROTC Chart"),className:"hover:text-white transition-colors",children:e.jsx(c,{size:16})})]})]}),e.jsx("div",{className:"p-4 h-64",children:e.jsx(r,{width:"100%",height:"100%",children:e.jsxs(o,{children:[e.jsx(h,{data:z.length>0?z:[{name:"No Data",value:1}],cx:"50%",cy:"50%",labelLine:!1,label:N,outerRadius:80,fill:"#8884d8",dataKey:"value",children:z.length>0?z.map((a,s)=>e.jsx(x,{fill:f[a.name.split(" ")[0]]||"#ccc"},`cell-${s}`)):e.jsx(x,{fill:"#eee"})}),e.jsx(m,{layout:"vertical",verticalAlign:"middle",align:"right"}),e.jsx(g,{content:e.jsx(G,{})})]})})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border-t-4 border-blue-900",children:[e.jsx("div",{className:"bg-gray-900 px-4 py-3",children:e.jsx("h3",{className:"text-white font-bold",children:"Ongoing Summary"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-gray-900 text-white p-3 font-bold flex justify-between items-center rounded-t mb-4",children:[e.jsx("span",{children:"TOTAL NUMBER OF CADETS (ONGOING)"}),e.jsx("span",{children:M.ongoing.total})]}),e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-2 font-bold text-gray-700",children:[e.jsx("span",{children:"Total Basic Cadets (Ongoing)"}),e.jsx("span",{children:M.ongoing.basic.total})]}),e.jsxs("div",{className:"flex justify-between items-center border-b pb-2 pl-4 text-gray-600",children:[e.jsx("span",{children:"Total MS1"}),e.jsx("span",{children:M.ongoing.basic.MS1})]}),e.jsxs("div",{className:"flex justify-between items-center border-b pb-2 pl-4 text-gray-600",children:[e.jsx("span",{children:"Total MS2"}),e.jsx("span",{children:M.ongoing.basic.MS2})]}),e.jsxs("div",{className:"flex justify-between items-center border-b pb-2 font-bold text-gray-700 mt-4",children:[e.jsx("span",{children:"Total Advance Cadets (Ongoing)"}),e.jsx("span",{children:M.ongoing.advance.total})]}),e.jsxs("div",{className:"flex justify-between items-center border-b pb-2 pl-4 text-gray-600",children:[e.jsx("span",{children:"Total MS31"}),e.jsx("span",{children:M.ongoing.advance.MS31})]}),e.jsxs("div",{className:"flex justify-between items-center border-b pb-2 pl-4 text-gray-600",children:[e.jsx("span",{children:"Total MS32"}),e.jsx("span",{children:M.ongoing.advance.MS32})]}),e.jsxs("div",{className:"flex justify-between items-center border-b pb-2 pl-4 text-gray-600",children:[e.jsx("span",{children:"Total MS41"}),e.jsx("span",{children:M.ongoing.advance.MS41})]}),e.jsxs("div",{className:"flex justify-between items-center border-b pb-2 pl-4 text-gray-600",children:[e.jsx("span",{children:"Total MS42"}),e.jsx("span",{children:M.ongoing.advance.MS42})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md border-t-4 border-green-600 h-80",children:[e.jsxs("div",{className:"bg-gray-900 px-4 py-3 flex justify-between items-center",children:[e.jsx("h3",{className:"text-white font-bold",children:"Completed Cadets"}),e.jsxs("div",{className:"space-x-2 text-gray-400",children:[e.jsx("button",{children:e.jsx(d,{size:16})}),e.jsx("button",{children:e.jsx(c,{size:16})})]})]}),e.jsx("div",{className:"p-4 h-64",children:e.jsx(r,{width:"100%",height:"100%",children:e.jsxs(o,{children:[e.jsx(h,{data:F.length>0?F:[{name:"No Data",value:1}],cx:"50%",cy:"50%",labelLine:!1,label:N,outerRadius:80,fill:"#22c55e",dataKey:"value",children:F.length>0?F.map((a,s)=>e.jsx(x,{fill:"Basic"===a.name?f.Basic:f.Advance},`cell-${s}`)):e.jsx(x,{fill:"#eee"})}),e.jsx(m,{layout:"vertical",verticalAlign:"middle",align:"right"}),e.jsx(g,{content:e.jsx(G,{})})]})})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border-t-4 border-amber-500 h-80",children:[e.jsxs("div",{className:"bg-gray-900 px-4 py-3 flex justify-between items-center",children:[e.jsx("h3",{className:"text-white font-bold",children:"Incomplete Cadets"}),e.jsxs("div",{className:"space-x-2 text-gray-400",children:[e.jsx("button",{children:e.jsx(d,{size:16})}),e.jsx("button",{children:e.jsx(c,{size:16})})]})]}),e.jsx("div",{className:"p-4 h-64",children:e.jsx(r,{width:"100%",height:"100%",children:e.jsxs(o,{children:[e.jsx(h,{data:P.length>0?P:[{name:"No Data",value:1}],cx:"50%",cy:"50%",labelLine:!1,label:N,outerRadius:80,fill:"#f59e0b",dataKey:"value",children:P.length>0?P.map((a,s)=>e.jsx(x,{fill:"Basic"===a.name?f.Basic:f.Advance},`cell-${s}`)):e.jsx(x,{fill:"#eee"})}),e.jsx(m,{layout:"vertical",verticalAlign:"middle",align:"right"}),e.jsx(g,{content:e.jsx(G,{})})]})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md border-t-4 border-blue-900",children:[e.jsx("div",{className:"bg-gray-900 px-4 py-3",children:e.jsx("h3",{className:"text-white font-bold",children:"Gender by Cadet Course"})}),e.jsx("div",{className:"p-4 h-64",children:e.jsx(r,{width:"100%",height:"100%",children:e.jsxs(j,{data:D,children:[e.jsx(b,{strokeDasharray:"3 3",vertical:!1}),e.jsx(u,{dataKey:"name"}),e.jsx(p,{allowDecimals:!1}),e.jsx(g,{}),e.jsx(m,{}),e.jsx(v,{dataKey:"Male",stackId:"g",fill:"#3b82f6"}),e.jsx(v,{dataKey:"Female",stackId:"g",fill:"#ef4444"}),e.jsx(v,{dataKey:"Unknown",stackId:"g",fill:"#6b7280"})]})})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border-t-4 border-blue-900",children:[e.jsx("div",{className:"bg-gray-900 px-4 py-3",children:e.jsx("h3",{className:"text-white font-bold",children:"Course Distribution"})}),e.jsx("div",{className:"p-4 h-64",children:e.jsx(r,{width:"100%",height:"100%",children:e.jsxs(j,{data:A,children:[e.jsx(b,{strokeDasharray:"3 3",vertical:!1}),e.jsx(u,{dataKey:"name"}),e.jsx(p,{allowDecimals:!1}),e.jsx(g,{}),e.jsx(m,{}),e.jsx(v,{dataKey:"value",fill:"#16a34a"})]})})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border-t-4 border-blue-900",children:[e.jsx("div",{className:"bg-gray-900 px-4 py-3",children:e.jsx("h3",{className:"text-white font-bold",children:"Religion Distribution"})}),e.jsx("div",{className:"p-4 h-64",children:e.jsx(r,{width:"100%",height:"100%",children:e.jsxs(j,{data:E,children:[e.jsx(b,{strokeDasharray:"3 3",vertical:!1}),e.jsx(u,{dataKey:"name"}),e.jsx(p,{allowDecimals:!1}),e.jsx(g,{}),e.jsx(m,{}),e.jsx(v,{dataKey:"value",fill:"#06b6d4"})]})})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border-t-4 border-blue-900",children:[e.jsx("div",{className:"bg-gray-900 px-4 py-3",children:e.jsx("h3",{className:"text-white font-bold",children:"Age Distribution"})}),e.jsx("div",{className:"p-4 h-64",children:e.jsx(r,{width:"100%",height:"100%",children:e.jsxs(j,{data:R,children:[e.jsx(b,{strokeDasharray:"3 3",vertical:!1}),e.jsx(u,{dataKey:"name"}),e.jsx(p,{allowDecimals:!1}),e.jsx(g,{}),e.jsx(m,{}),e.jsx(v,{dataKey:"value",fill:"#a855f7"})]})})})]})]}),e.jsxs("div",{className:"mt-4 bg-green-900 text-white rounded-lg p-4 shadow-md",children:[e.jsxs("div",{className:"flex items-center mb-3 border-b border-green-700 pb-1",children:[e.jsx(y,{size:18,className:"text-yellow-400 mr-2"}),e.jsx("span",{className:"font-semibold text-sm uppercase tracking-wide",children:"Quick Actions"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsx(l,{to:"/admin/data-analysis",className:"flex items-center justify-center px-3 py-2 rounded bg-white/10 hover:bg-white/20 text-xs md:text-sm",children:"Data Analysis"}),e.jsx(l,{to:"/admin/grading",className:"flex items-center justify-center px-3 py-2 rounded bg-white/10 hover:bg-white/20 text-xs md:text-sm",children:"Grading"}),e.jsx(l,{to:"/admin/activities",className:"flex items-center justify-center px-3 py-2 rounded bg-white/10 hover:bg-white/20 text-xs md:text-sm",children:"Activities"}),e.jsx(l,{to:"/admin/messages",className:"flex items-center justify-center px-3 py-2 rounded bg-white/10 hover:bg-white/20 text-xs md:text-sm",children:"Messages"})]})]})]})};export{S as default};
