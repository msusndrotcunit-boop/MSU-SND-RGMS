import{c as e,j as a,b as t}from"./index-b5aGx8Xb.js";import{r as s}from"./vendor-react-BJYbxeCs.js";import{a as n}from"./vendor-utils-qHW_S61q.js";import{J as r,a9 as l,ah as i,T as c,a7 as d,n as o}from"./vendor-ui-Cf-65S3f.js";import{R as m}from"./ResponsiveTable-C00et9LP.js";import"./useResponsive-XC39aU2L.js";const u=()=>{const[u,h]=s.useState([]),[x,p]=s.useState(!0),[f,y]=s.useState(""),[g,w]=s.useState([]),[v,b]=s.useState(!1),j=async()=>{p(!0);try{const a=await n.get("/api/admin/cadets/archived");h(a.data||[]),await e("admin","archived_cadets_list",{data:a.data,timestamp:Date.now()})}catch(a){}finally{p(!1)}};s.useEffect(()=>{let a;(async()=>{try{const a=await e("admin","archived_cadets_list",null);(null==a?void 0:a.data)&&(null==a?void 0:a.timestamp)&&Date.now()-a.timestamp<12e4&&(h(a.data),p(!1))}catch{}await j()})();const t=()=>{try{a=new EventSource("/api/attendance/events"),a.onmessage=e=>{try{const a=JSON.parse(e.data||"{}");new Set(["cadet_deleted","cadet_updated","cadet_created"]).has(a.type)&&j()}catch{}},a.onerror=()=>{try{a&&a.close()}catch{}setTimeout(t,3e3)}}catch{}};return t(),()=>{try{a&&a.close()}catch{}}},[]);const N=u.filter(e=>{if(!f)return!0;const a=f.toLowerCase();return e.first_name&&e.first_name.toLowerCase().includes(a)||e.last_name&&e.last_name.toLowerCase().includes(a)||e.username&&e.username.toLowerCase().includes(a)||e.student_id&&e.student_id.toLowerCase().includes(a)||e.company&&e.company.toLowerCase().includes(a)});return x?a.jsx("div",{className:"text-center p-10",children:"Loading..."}):a.jsxs("div",{children:[a.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[a.jsx("h2",{className:"text-2xl font-bold",children:"Archived Cadets"}),a.jsxs("div",{className:"flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2 w-full md:w-auto",children:[a.jsxs("div",{className:"relative flex-1 md:flex-none",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx(r,{size:18,className:"text-gray-400"})}),a.jsx("input",{type:"text",placeholder:"Search archived cadets...",className:"pl-10 pr-4 py-2 border rounded w-full md:w-64 focus:outline-none focus:ring-2 focus:ring-blue-500",value:f,onChange:e=>y(e.target.value)})]}),g.length>0&&a.jsxs("button",{onClick:async()=>{if(0!==g.length&&window.confirm(`Restore ${g.length} archived cadets? Their access may be re-enabled.`))try{await n.post("/api/admin/cadets/restore",{ids:g}),o.success("Cadets restored successfully"),w([]),await t("attendance_by_day"),await e("admin","cadets_list",null),j()}catch(a){o.error("Failed to restore cadets")}},className:"flex-1 md:flex-none bg-green-600 text-white px-4 py-2 rounded flex items-center justify-center space-x-2 hover:bg-green-700 animate-fade-in",children:[a.jsx(l,{size:18}),a.jsxs("span",{children:["Restore (",g.length,")"]})]}),g.length>0&&a.jsxs("button",{onClick:async()=>{var e;if(0!==g.length&&window.confirm(`Reclaim credentials for ${g.length} archived cadets? Their usernames will be renamed and emails cleared.`))try{const a=((null==(e=(await n.post("/api/admin/cadets/reclaim-credentials",{cadetIds:g})).data)?void 0:e.results)||[]).filter(e=>e.updated>0).length;o.success(`Reclaimed ${a} accounts`),w([]),await j()}catch(a){o.error("Failed to reclaim credentials")}},className:"flex-1 md:flex-none bg-amber-600 text-white px-4 py-2 rounded flex items-center justify-center space-x-2 hover:bg-amber-700 animate-fade-in",children:[a.jsx(i,{size:18}),a.jsxs("span",{children:["Reclaim (",g.length,")"]})]}),g.length>0&&a.jsxs("button",{onClick:async()=>{var a,t;if(0!==g.length&&window.confirm(`Permanently delete ${g.length} archived cadets? This action cannot be undone.`))try{await n.post("/api/admin/cadets/delete-permanent",{ids:g});o.success(`Deleted ${g.length} cadets permanently`),w([]),await e("admin","archived_cadets_list",null),await j()}catch(s){const e=(null==(t=null==(a=s.response)?void 0:a.data)?void 0:t.message)||"Failed to delete permanently";o.error(e)}},className:"flex-1 md:flex-none bg-red-700 text-white px-4 py-2 rounded flex items-center justify-center space-x-2 hover:bg-red-800 animate-fade-in",children:[a.jsx(c,{size:18}),a.jsxs("span",{children:["Delete (",g.length,")"]})]}),a.jsxs("button",{onClick:async()=>{b(!0);try{await e("admin","archived_cadets_list",null),await j(),o.success("Refreshed")}catch(a){}finally{b(!1)}},disabled:v,className:"flex-1 md:flex-none bg-gray-600 text-white px-4 py-2 rounded flex items-center justify-center space-x-2 hover:bg-gray-700 "+(v?"opacity-50 cursor-not-allowed":""),children:[a.jsx(d,{size:18,className:v?"animate-spin":""}),a.jsx("span",{children:v?"Refreshing...":"Refresh"})]})]})]}),a.jsx(m,{data:N,columns:[{key:"name",label:"Name & Rank",render:(e,t)=>a.jsxs("div",{children:[a.jsxs("div",{className:"font-medium",children:[a.jsx("span",{className:"font-bold text-blue-900 mr-1",children:t.rank}),t.last_name,", ",t.first_name]}),a.jsx("div",{className:"text-xs text-gray-500",children:t.email})]})},{key:"username",label:"Username",headerClassName:"px-3",cellClassName:"px-3 whitespace-nowrap",render:(e,a)=>a.username||a.student_id},{key:"unit",label:"Unit (Coy/Plt)",align:"center",headerClassName:"px-2",cellClassName:"px-2 whitespace-nowrap",render:(e,a)=>`${a.company||"-"}/${a.platoon||"-"}`},{key:"status",label:"Status",align:"center",headerClassName:"px-2",cellClassName:"px-2",render:()=>a.jsx("span",{className:"text-xs font-semibold px-2 py-1 rounded bg-gray-100 text-gray-800 border border-gray-200",children:"Archived"})}],loading:x,emptyMessage:"No archived cadets found.",selectable:!0,selectedItems:g,onSelectionChange:w,sortable:!0,filterable:!0,pagination:!0,itemsPerPage:20,cardLayout:"never",className:"bg-white rounded shadow"})]})};export{u as default};
