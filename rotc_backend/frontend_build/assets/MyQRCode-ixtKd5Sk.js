import{u as e,j as t}from"./index-Df_F6O4f.js";import{r as n,L as r}from"./vendor-react-BJYbxeCs.js";import{a}from"./vendor-utils-qHW_S61q.js";import{b as i}from"./vendor-media-Cvam96dz.js";import{n as s,aQ as o,D as d,aq as l}from"./vendor-ui-Cf-65S3f.js";const c=()=>{const{user:c}=e(),[m,f]=n.useState(null),[u,p]=n.useState(""),[g,x]=n.useState(!0),y=n.useRef(null);n.useEffect(()=>{h()},[]);const h=async()=>{try{const e=await a.get("/api/staff/me");f(e.data),e.data.qr_code_data&&p(e.data.qr_code_data),x(!1)}catch(e){x(!1),s.error("Failed to load profile")}};if(g)return t.jsx("div",{className:"p-6",children:"Loading..."});if(!m)return t.jsx("div",{className:"p-6",children:"No profile found"});const b=!!m.is_profile_completed;return t.jsx("div",{className:"max-w-3xl mx-auto p-4",children:t.jsxs("div",{className:"bg-white rounded-lg shadow p-6 border-t-4 border-green-800",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"font-bold text-xl text-gray-800",children:"My QR Code"}),t.jsx(r,{to:"/staff/profile",className:"text-sm text-green-700 hover:underline",children:"Back to Profile"})]}),t.jsx("p",{className:"text-sm text-gray-600 mb-4",children:u?"Your unique QR code is ready. Regenerate if you've updated your profile.":"Generate your unique QR code after completing your profile. This QR code will persist and only needs regeneration if you update your profile information."}),t.jsxs("div",{className:"flex flex-col items-center",children:[u?t.jsx("img",{ref:y,src:u,alt:"QR Code",className:"w-64 h-64 border-4 border-green-800 rounded-lg"}):t.jsx("div",{className:"w-64 h-64 bg-gray-100 flex items-center justify-center text-gray-400 rounded-lg",children:"No QR yet"}),t.jsxs("div",{className:"mt-4 flex gap-2",children:[t.jsxs("button",{onClick:async()=>{if(!m)return;const e=Date.now(),t=Math.random().toString(36).substring(2,15),n=`STAFF-${m.id}-${e}-${t}`,r={id:m.id,role:"training_staff",afpsn:m.afpsn,name:`${m.rank||""} ${m.first_name||""} ${m.last_name||""}`.trim(),contact_number:m.contact_number||"",email:m.email||"",rotc_unit:m.rotc_unit||"",mobilization_center:m.mobilization_center||"",unique_id:n,generated_at:new Date(e).toISOString(),profile_version:`${m.first_name}-${m.last_name}-${m.afpsn}-${e}`.replace(/\s+/g,"-")};try{const e=JSON.stringify(r),t=await i.toDataURL(e,{errorCorrectionLevel:"M"});p(t);try{await a.post("/api/staff/qr-code",{qr_data:t})}catch(o){}s.success("Unique QR code generated successfully")}catch(d){s.error("Failed to generate QR code")}},className:"bg-green-700 hover:bg-green-800 text-white px-4 py-2 rounded flex items-center gap-2",children:[t.jsx(o,{size:16})," ",u?"Regenerate":"Generate"]}),t.jsxs("button",{onClick:()=>{if(!u)return;const e=document.createElement("a");e.href=u,e.download=`staff-qr-${(null==m?void 0:m.afpsn)||(null==m?void 0:m.id)}.png`,document.body.appendChild(e),e.click(),document.body.removeChild(e)},disabled:!u,className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded flex items-center gap-2 disabled:opacity-50",children:[t.jsx(d,{size:16})," Download"]}),t.jsxs("button",{onClick:()=>{if(!u||!m)return;const e=window.open("","_blank");e.document.write(`\n      <html>\n        <head>\n          <title>My QR Code</title>\n          <style>\n            body { display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; font-family:sans-serif; }\n            img { width:300px; height:300px; }\n            h2 { margin-top: 16px; }\n            p { color:#666 }\n          </style>\n        </head>\n        <body>\n          <img src="${u}" />\n          <h2>${m.rank||""} ${m.first_name||""} ${m.last_name||""}</h2>\n          <p>AFPSN: ${m.afpsn||""}</p>\n          <p>Training Staff</p>\n          <script>window.onload = function(){ window.print(); window.close(); }<\/script>\n        </body>\n      </html>\n    `),e.document.close()},disabled:!u,className:"bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded flex items-center gap-2 disabled:opacity-50",children:[t.jsx(l,{size:16})," Print"]})]}),u&&t.jsx("div",{className:"mt-4 text-xs text-green-700 bg-green-100 px-3 py-2 rounded",children:"âœ“ QR code generated and saved. It will remain visible until you regenerate it."}),!b&&t.jsx("div",{className:"mt-2 text-xs text-amber-700 bg-amber-100 px-3 py-2 rounded",children:"Complete your profile to lock details and avoid frequent regeneration."})]})]})})};export{c as default};
