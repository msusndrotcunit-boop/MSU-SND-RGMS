import{j as e}from"./index-b5aGx8Xb.js";import{r as s,L as a}from"./vendor-react-BJYbxeCs.js";import{a as t,c as l}from"./vendor-utils-qHW_S61q.js";import{n as r,w as d,J as i,a6 as n,N as c,am as o,a as x,az as m,a3 as u}from"./vendor-ui-Cf-65S3f.js";const g=()=>{const[g,h]=s.useState([]),[f,p]=s.useState(!1),[b,j]=s.useState("all"),[v,y]=s.useState(""),[N,w]=s.useState(null),[C,_]=s.useState(""),[S,L]=s.useState(!1);s.useEffect(()=>{z()},[]);const z=async()=>{try{p(!0);const e=await t.get("/api/messages");h(e.data)}catch(e){r.error("Failed to load messages")}finally{p(!1)}},R=g.filter(e=>{const s="all"===b||e.status===b,a=e.subject.toLowerCase().includes(v.toLowerCase())||e.message.toLowerCase().includes(v.toLowerCase())||e.cadet_last&&e.cadet_last.toLowerCase().includes(v.toLowerCase())||e.staff_last&&e.staff_last.toLowerCase().includes(v.toLowerCase())||e.username.toLowerCase().includes(v.toLowerCase());return s&&a});return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-100px)] gap-4",children:[e.jsxs("div",{className:l("flex-1 bg-white rounded-lg shadow-md flex flex-col",N?"hidden md:flex md:w-1/3 md:flex-none":"w-full"),children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2 mb-4",children:[e.jsx(d,{className:"text-blue-600"}),"Admin Messages"]}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(i,{className:"absolute left-2 top-2.5 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search messages...",value:v,onChange:e=>y(e.target.value),className:"w-full pl-8 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:b,onChange:e=>j(e.target.value),className:"appearance-none bg-gray-50 border rounded-lg py-2 pl-3 pr-8 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"resolved",children:"Resolved"})]}),e.jsx(n,{className:"absolute right-2 top-2.5 text-gray-400 pointer-events-none",size:16})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:f?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading..."}):0===R.length?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No messages found."}):e.jsx("div",{className:"divide-y",children:R.map(s=>e.jsxs("div",{onClick:()=>w(s),className:l("p-4 cursor-pointer hover:bg-gray-50 transition-colors",(null==N?void 0:N.id)===s.id?"bg-blue-50 border-l-4 border-blue-500":"border-l-4 border-transparent","pending"===s.status?"font-medium":"text-gray-600"),children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("div",{className:"text-sm font-semibold",children:"cadet"===s.sender_role?e.jsxs("span",{className:"text-blue-600",children:["Cadet ",s.cadet_last||s.username]}):e.jsxs("span",{className:"text-green-600",children:["Staff ",s.staff_last||s.username]})}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleDateString()})]}),e.jsx("div",{className:"text-sm font-bold truncate mb-1",children:s.subject}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:s.message}),e.jsx("div",{className:"mt-2 flex items-center gap-1 text-xs",children:"resolved"===s.status?e.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(c,{size:12})," Resolved"]}):e.jsxs("span",{className:"flex items-center gap-1 text-yellow-600",children:[e.jsx(o,{size:12})," Pending"]})})]},s.id))})})]}),N?e.jsxs("div",{className:"flex-1 bg-white rounded-lg shadow-md flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-gray-50",children:[e.jsx("h2",{className:"text-lg font-bold",children:N.subject}),e.jsx("button",{onClick:()=>w(null),className:"md:hidden text-gray-500",children:"Close"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx(x,{size:24,className:"text-gray-500"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"cadet"===N.sender_role?`Cadet ${N.cadet_first||""} ${N.cadet_last||N.username}`:`Staff ${N.staff_first||""} ${N.staff_last||N.username}`}),e.jsxs("div",{className:"text-sm text-gray-500",children:[N.sender_role.toUpperCase()," â€¢ ",N.user_email||"No Email"]}),e.jsx("div",{className:"text-xs text-gray-400",children:new Date(N.created_at).toLocaleString()})]})]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border mb-6",children:e.jsx("p",{className:"whitespace-pre-wrap text-gray-800",children:N.message})}),N.admin_reply&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-100 mb-6",children:[e.jsx("div",{className:"text-sm font-semibold text-blue-800 mb-2",children:"Previous Reply:"}),e.jsx("p",{className:"whitespace-pre-wrap text-gray-800",children:N.admin_reply})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reply to User"}),e.jsx("textarea",{value:C,onChange:e=>_(e.target.value),className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none h-32",placeholder:"Type your reply here..."}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{onClick:async()=>{if(N&&C.trim())try{L(!0),await t.put(`/api/messages/${N.id}/reply`,{admin_reply:C,status:"resolved"}),r.success("Reply sent successfully"),_(""),w(null),z()}catch(e){r.error("Failed to send reply")}finally{L(!1)}},disabled:S||!C.trim(),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 disabled:opacity-50",children:S?"Sending...":e.jsxs(e.Fragment,{children:[e.jsx(m,{size:18}),"Send Reply & Resolve"]})})})]})]})]}):e.jsx("div",{className:"hidden md:flex flex-1 bg-gray-50 rounded-lg border border-dashed border-gray-300 items-center justify-center text-gray-400",children:"Select a message to view details"}),e.jsxs("div",{className:"mt-2 bg-green-900 text-white rounded-lg p-4 shadow-md",children:[e.jsxs("div",{className:"flex items-center mb-3 border-b border-green-700 pb-1",children:[e.jsx(u,{size:18,className:"text-yellow-400 mr-2"}),e.jsx("span",{className:"font-semibold text-sm uppercase tracking-wide",children:"Quick Actions"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsx(a,{to:"/admin/data-analysis",className:"flex items-center justify-center px-3 py-2 rounded bg-white/10 hover:bg-white/20 text-xs md:text-sm",children:"Data Analysis"}),e.jsx(a,{to:"/admin/grading",className:"flex items-center justify-center px-3 py-2 rounded bg-white/10 hover:bg-white/20 text-xs md:text-sm",children:"Grading"}),e.jsx(a,{to:"/admin/activities",className:"flex items-center justify-center px-3 py-2 rounded bg-white/10 hover:bg-white/20 text-xs md:text-sm",children:"Activities"}),e.jsx(a,{to:"/admin/messages",className:"flex items-center justify-center px-3 py-2 rounded bg-white/20 text-xs md:text-sm",children:"Messages"})]})]})]})};export{g as default};
