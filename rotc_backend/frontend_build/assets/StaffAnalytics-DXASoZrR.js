import{g as e,c as a,j as t}from"./index-Df_F6O4f.js";import{r as s}from"./vendor-react-BJYbxeCs.js";import{a as n}from"./vendor-utils-qHW_S61q.js";import{U as r,r as l,ax as i,am as d,V as c,W as o,Y as x,Z as h,_ as m,$ as f,a1 as j,ay as u,ar as g,as as p,at as y,a0 as b}from"./vendor-ui-Cf-65S3f.js";const N=["#10B981","#EF4444","#F59E0B","#3B82F6"],v=()=>{const[v,w]=s.useState({totalStaff:0,staffByRank:[],attendanceStats:[]}),[S,k]=s.useState(!0);s.useEffect(()=>{B()},[]),s.useEffect(()=>{let e;const a=()=>{try{e=new EventSource("/api/attendance/events"),e.onmessage=e=>{try{"staff_attendance_updated"===JSON.parse(e.data||"{}").type&&B()}catch{}},e.onerror=()=>{try{e&&e.close()}catch{}setTimeout(a,3e3)}}catch{}};return a(),()=>{try{e&&e.close()}catch{}}},[]);const B=async()=>{try{try{const a=await e("admin","staff_analytics");if(a){let e=a,t=0;if(a.data&&a.timestamp&&(e=a.data,t=a.timestamp),w(e),k(!1),t&&Date.now()-t<3e5)return}}catch(t){}const s=localStorage.getItem("token"),r=await n.get("/api/staff/analytics/overview",{headers:{Authorization:`Bearer ${s}`}});w(r.data),k(!1),await a("admin","staff_analytics",{data:r.data,timestamp:Date.now()})}catch(s){k(!1)}},R=s.useMemo(()=>{if(!v.staffByRank||0===v.staffByRank.length)return[];const e={};return v.staffByRank.forEach(a=>{const t=(a.rank||"Unverified").trim().split(" ").filter(Boolean).map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ");e[t]=(e[t]||0)+parseInt(a.count||0,10)}),Object.entries(e).map(([e,a])=>({rank:e,count:a}))},[v.staffByRank]);if(S)return t.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-700"})});const E=e=>{const a=v.attendanceStats.find(a=>a.status===e);return a?a.count:0};return v.attendanceStats.reduce((e,a)=>e+a.count,0),t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Training Staff Analytics"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsx("div",{className:"bg-white p-4 rounded-lg shadow border-l-4 border-blue-500",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500 text-sm",children:"Total Staff"}),t.jsx("p",{className:"text-2xl font-bold",children:v.totalStaff})]}),t.jsx(r,{className:"text-blue-500",size:24})]})}),t.jsx("div",{className:"bg-white p-4 rounded-lg shadow border-l-4 border-green-500",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500 text-sm",children:"Total Present"}),t.jsx("p",{className:"text-2xl font-bold",children:E("present")})]}),t.jsx(l,{className:"text-green-500",size:24})]})}),t.jsx("div",{className:"bg-white p-4 rounded-lg shadow border-l-4 border-red-500",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500 text-sm",children:"Total Absent"}),t.jsx("p",{className:"text-2xl font-bold",children:E("absent")})]}),t.jsx(i,{className:"text-red-500",size:24})]})}),t.jsx("div",{className:"bg-white p-4 rounded-lg shadow border-l-4 border-yellow-500",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500 text-sm",children:"Total Late"}),t.jsx("p",{className:"text-2xl font-bold",children:E("late")})]}),t.jsx(d,{className:"text-yellow-500",size:24})]})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Staff by Rank"}),v.staffByRank.length>0?t.jsx("div",{className:"h-64",children:t.jsx(c,{width:"100%",height:"100%",children:t.jsxs(o,{data:R,children:[t.jsx(x,{strokeDasharray:"3 3"}),t.jsx(h,{dataKey:"rank"}),t.jsx(m,{}),t.jsx(f,{}),t.jsx(j,{dataKey:"count",fill:"#3b82f6",name:"Staff Count",children:t.jsx(u,{dataKey:"count",position:"top"})})]})})}):t.jsx("div",{className:"h-64 flex items-center justify-center text-gray-500",children:"No rank data available"})]}),t.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Attendance Overview"}),v.attendanceStats.length>0?t.jsx("div",{className:"h-64",children:t.jsx(c,{width:"100%",height:"100%",children:t.jsxs(g,{children:[t.jsx(p,{data:v.attendanceStats,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percent:a})=>`${e} ${(100*a).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"count",nameKey:"status",children:v.attendanceStats.map((e,a)=>t.jsx(y,{fill:N[a%N.length]},`cell-${a}`))}),t.jsx(f,{}),t.jsx(b,{})]})})}):t.jsx("div",{className:"h-64 flex items-center justify-center text-gray-500",children:"No attendance data available"})]})]})]})};export{v as default};
