import{g as e,c as t,j as a}from"./index-Df_F6O4f.js";import{r,b as s,L as i}from"./vendor-react-BJYbxeCs.js";import{a as l}from"./vendor-utils-qHW_S61q.js";import{i as n}from"./vendor-media-Cvam96dz.js";import{ab as d,t as o,an as c,T as m,X as x,aa as g,a9 as h,z as p,a3 as u}from"./vendor-ui-Cf-65S3f.js";const y=e=>{if(!e)return[];let t=[];if(Array.isArray(e.images))t=e.images;else if("string"==typeof e.images)try{const a=JSON.parse(e.images);Array.isArray(a)&&(t=a)}catch{}if(t=(t||[]).filter(Boolean),0===t.length&&e.image_path){return[e.image_path.startsWith("data:")?e.image_path:`https://msu-snd-rgms-1.onrender.com${e.image_path.replace(/\\/g,"/")}`]}return t.map(e=>e.startsWith("data:")||e.startsWith("http")?e:`https://msu-snd-rgms-1.onrender.com${String(e).replace(/\\/g,"/")}`)},b=()=>{const[b,f]=r.useState([]),[v,j]=r.useState("activity"),[w,N]=r.useState(!1),[k,C]=r.useState(!1),[E,z]=r.useState(null),[A,S]=r.useState({title:"",description:"",date:"",images:[]}),[W,H]=r.useState([]),[D,M]=r.useState({what:"",when:"",where:"",who:"",how:"",note:"",reminders:""}),[O,R]=r.useState(null),[$,T]=r.useState(0),[P,I]=r.useState("right");r.useEffect(()=>{q()},[]),r.useEffect(()=>{O&&(T(0),I("right"))},[O]);const q=async(a=!1)=>{if(!a)try{const t=await e("admin","activities_list");if(t){let e=t.data||(Array.isArray(t)?t:[]),a=t.timestamp||0;if(Array.isArray(e)&&(f(e),a&&Date.now()-a<3e5))return}}catch(r){}try{const e=await l.get("/api/cadet/activities");f(e.data),await t("admin","activities_list",{data:e.data,timestamp:Date.now()})}catch(s){}},[_,L]=r.useState(!1),B=s.useRef(null),F=()=>{S({title:"",description:"",date:"",images:[]}),M({what:"",when:"",where:"",who:"",how:"",note:"",reminders:""}),H([]),C(!1),z(null)};return a.jsxs("div",{className:"h-full flex flex-col gap-4",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 gap-3 bg-white dark:bg-gray-900 p-4 rounded shadow",children:[a.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800 dark:text-gray-100",children:"Activity Management"}),a.jsxs("button",{onClick:()=>{F(),N(!0)},className:"bg-[var(--primary-color)] text-white px-4 py-2 rounded flex items-center space-x-2 hover:opacity-90",children:[a.jsx(d,{size:18}),a.jsx("span",{children:"New Post"})]})]}),a.jsxs("div",{className:"flex space-x-1 mb-6 border-b border-gray-200 dark:border-gray-700",children:[a.jsx("button",{onClick:()=>j("activity"),className:"px-6 py-2 font-medium transition-colors "+("activity"===v?"border-b-2 border-[var(--primary-color)] text-[var(--primary-color)]":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"),children:"Activities"}),a.jsx("button",{onClick:()=>j("announcement"),className:"px-6 py-2 font-medium transition-colors "+("announcement"===v?"border-b-2 border-[var(--primary-color)] text-[var(--primary-color)]":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"),children:"Announcements"})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:b.filter(e=>(e.type||"activity")===v).map(e=>{const r=y(e),s=r[0]||null;return a.jsx("div",{className:"bg-white dark:bg-gray-900 rounded shadow overflow-hidden border border-gray-100 dark:border-gray-800 cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>R(e),children:a.jsxs("div",{className:"p-4",children:[a.jsx("h3",{className:"font-bold text-xl mb-2 text-gray-900 dark:text-gray-100",children:e.title}),a.jsxs("div",{className:"flex items-center text-gray-500 dark:text-gray-400 text-sm mb-3",children:[a.jsx(o,{size:14,className:"mr-1"}),new Date(e.date).toLocaleDateString()]}),a.jsxs("div",{className:"w-full h-48 mb-4 bg-gray-200 dark:bg-gray-800 rounded overflow-hidden relative",children:[s&&a.jsx("img",{src:s,alt:e.title,className:"w-full h-full object-cover"}),r.length>1&&a.jsxs("div",{className:"absolute top-2 right-2 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded",children:["+",r.length-1]})]}),a.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4 whitespace-pre-line line-clamp-3",children:e.description}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:t=>((e,t)=>{t&&t.stopPropagation(),C(!0),z(e.id),j(e.type||"activity"),S({title:e.title,description:e.description,date:e.date,images:[]});const a=y(e);if(H(a),"announcement"===e.type){const t=e.description||"",a=e=>{const a=new RegExp(`${e}:\\s*([^\\n]+)`,"i"),r=t.match(a);return r?r[1].trim():""};M({what:a("WHAT"),when:a("WHEN"),where:a("WHERE"),who:a("WHO"),how:a("HOW"),note:a("NOTE"),reminders:a("REMINDERS")})}N(!0)})(e,t),className:"text-blue-600 hover:text-blue-800 text-sm font-medium flex items-center z-10 relative",children:[a.jsx(c,{size:16,className:"mr-1"})," Edit"]}),a.jsxs("button",{onClick:a=>(async(e,a)=>{if(a&&a.stopPropagation(),confirm("Delete this item?"))try{await l.delete(`/api/admin/activities/${e}`);const a=b.filter(t=>t.id!==e);f(a),await t("admin","activities_list",{data:a,timestamp:Date.now()})}catch(r){alert("Error deleting item")}})(e.id,a),className:"text-red-600 hover:text-red-800 text-sm font-medium flex items-center z-10 relative",children:[a.jsx(m,{size:16,className:"mr-1"})," Delete"]})]})]})},e.id)})}),0===b.filter(e=>(e.type||"activity")===v).length&&a.jsxs("div",{className:"text-center py-10 text-gray-500 dark:text-gray-400",children:["No ",v,"s found."]}),w&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-2 sm:p-4 z-50 overflow-y-auto",children:a.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg w-full max-w-[95vw] sm:max-w-md md:max-w-lg p-3 sm:p-4 my-4 sm:my-6 max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex justify-between items-center mb-3",children:[a.jsxs("h3",{className:"text-base sm:text-lg font-bold text-gray-800 dark:text-gray-100",children:[k?"Edit":"Add"," ","activity"===v?"Activity":"Announcement"]}),a.jsx("button",{onClick:()=>{N(!1),F()},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded",children:a.jsx(x,{size:20})})]}),a.jsxs("div",{className:"flex space-x-2 sm:space-x-4 mb-3 border-b border-gray-200 dark:border-gray-700 pb-2",children:[a.jsx("button",{onClick:()=>j("activity"),className:"font-medium text-xs sm:text-sm "+("activity"===v?"text-[var(--primary-color)]":"text-gray-500 dark:text-gray-400"),children:"Activity"}),a.jsx("button",{onClick:()=>j("announcement"),className:"font-medium text-xs sm:text-sm "+("announcement"===v?"text-[var(--primary-color)]":"text-gray-500 dark:text-gray-400"),children:"Announcement"})]}),a.jsxs("form",{onSubmit:async e=>{var t,a;e.preventDefault();const r=W.length+A.images.length;if("activity"===v&&r<1)return void alert("Please upload at least 1 photo for an activity.");if("activity"===v&&r>5)return void alert("Maximum 5 photos allowed for an activity.");if("announcement"===v&&r<1)return void alert("Please upload at least 1 photo for an announcement.");const s=new FormData;if(s.append("title",A.title),s.append("date",A.date||(new Date).toISOString().split("T")[0]),s.append("type",v),"announcement"===v){const e=`WHAT: ${D.what}\nWHEN: ${D.when}\nWHERE: ${D.where}\nWHO: ${D.who}\nHOW: ${D.how}\n\nNOTE: ${D.note}\nREMINDERS: ${D.reminders}`;s.append("description",e)}else s.append("description",A.description);k&&s.append("existingImages",JSON.stringify(W)),A.images.forEach(e=>{s.append("images",e)});try{if(k){await l.put(`/api/admin/activities/${E}`,s,{headers:{"Content-Type":"multipart/form-data"}})}else{await l.post("/api/admin/activities",s,{headers:{"Content-Type":"multipart/form-data"}})}q(!0),N(!1),F()}catch(i){alert(`Error ${k?"updating":"uploading"} activity: `+((null==(a=null==(t=i.response)?void 0:t.data)?void 0:a.message)||i.message))}},className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Title"}),a.jsx("input",{type:"text",required:!0,className:"w-full border rounded p-2 text-sm bg-white dark:bg-gray-900 dark:border-gray-700 dark:text-gray-100",value:A.title,onChange:e=>S({...A,title:e.target.value})})]}),"activity"===v?a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Description"}),a.jsx("textarea",{required:!0,className:"w-full border rounded p-2 text-sm bg-white dark:bg-gray-900 dark:border-gray-700 dark:text-gray-100",rows:"3",value:A.description,onChange:e=>S({...A,description:e.target.value})})]}):a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:[a.jsxs("div",{className:"col-span-1 sm:col-span-2",children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"WHAT"}),a.jsx("input",{type:"text",required:!0,className:"w-full border rounded p-2 text-sm bg-white dark:bg-gray-900 dark:border-gray-700 dark:text-gray-100",value:D.what,onChange:e=>M({...D,what:e.target.value})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"WHEN"}),a.jsx("input",{type:"text",required:!0,className:"w-full border rounded p-2 text-sm bg-white dark:bg-gray-900 dark:border-gray-700 dark:text-gray-100",value:D.when,onChange:e=>M({...D,when:e.target.value})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"WHERE"}),a.jsx("input",{type:"text",required:!0,className:"w-full border rounded p-2 text-sm bg-white dark:bg-gray-900 dark:border-gray-700 dark:text-gray-100",value:D.where,onChange:e=>M({...D,where:e.target.value})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"WHO"}),a.jsx("input",{type:"text",required:!0,className:"w-full border rounded p-2 text-sm bg-white dark:bg-gray-900 dark:border-gray-700 dark:text-gray-100",value:D.who,onChange:e=>M({...D,who:e.target.value})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"HOW"}),a.jsx("input",{type:"text",required:!0,className:"w-full border rounded p-2 text-sm bg-white dark:bg-gray-900 dark:border-gray-700 dark:text-gray-100",value:D.how,onChange:e=>M({...D,how:e.target.value})})]}),a.jsxs("div",{className:"col-span-1 sm:col-span-2",children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"NOTE"}),a.jsx("textarea",{className:"w-full border rounded p-2 text-sm bg-white dark:bg-gray-900 dark:border-gray-700 dark:text-gray-100",rows:"2",value:D.note,onChange:e=>M({...D,note:e.target.value})})]}),a.jsxs("div",{className:"col-span-1 sm:col-span-2",children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"REMINDERS"}),a.jsx("textarea",{className:"w-full border rounded p-2 text-sm bg-white dark:bg-gray-900 dark:border-gray-700 dark:text-gray-100",rows:"2",value:D.reminders,onChange:e=>M({...D,reminders:e.target.value})})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Date"}),a.jsx("input",{type:"date",required:!0,className:"w-full border rounded p-2 text-sm bg-white dark:bg-gray-900 dark:border-gray-700 dark:text-gray-100",value:A.date,onChange:e=>S({...A,date:e.target.value})})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:["Photos (Min: 1, Max: ","activity"===v?"5":"Unlimited",")"]}),k&&W.length>0&&a.jsxs("div",{className:"mt-2 mb-3",children:[a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"Existing Images:"}),a.jsx("div",{className:"grid grid-cols-3 gap-2",children:W.map((e,t)=>a.jsxs("div",{className:"relative h-16 sm:h-20 bg-gray-100 dark:bg-gray-800 rounded overflow-hidden group",children:[a.jsx("img",{src:e,alt:"existing",className:"w-full h-full object-cover"}),a.jsx("button",{type:"button",onClick:()=>H(W.filter((e,a)=>a!==t)),className:"absolute top-0 right-0 bg-red-500 text-white p-1 rounded-bl opacity-0 group-hover:opacity-100 transition-opacity",children:a.jsx(x,{size:12})})]},t))})]}),a.jsx("div",{className:"mt-2 flex items-center justify-center px-2 sm:px-4 pt-3 pb-4 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-md",children:a.jsxs("div",{className:"space-y-1 text-center",children:[a.jsx(g,{className:"mx-auto h-8 w-8 sm:h-10 sm:w-10 text-gray-400 dark:text-gray-500"}),a.jsx("div",{className:"flex text-xs sm:text-sm text-gray-600 dark:text-gray-300",children:a.jsxs("label",{htmlFor:"file-upload",className:"relative cursor-pointer bg-white dark:bg-gray-900 rounded-md font-medium text-[var(--primary-color)] hover:opacity-90 focus-within:outline-none",children:[a.jsx("span",{children:k?"Add More":"Upload"}),a.jsx("input",{id:"file-upload",type:"file",multiple:!0,className:"sr-only",onChange:async e=>{const t=Array.from(e.target.files),a=[];if("activity"===v){if(W.length+A.images.length+t.length>5)return void alert(`Maximum 5 photos allowed for activities. You can only add ${5-W.length-A.images.length} more photo(s).`)}for(const s of t)if(s.size>20971520)alert(`File "${s.name}" is too large. Maximum size is 20MB.`);else try{const e="announcement"===v?{maxSizeMB:5,maxWidthOrHeight:2048,useWebWorker:!0}:{maxSizeMB:.5,maxWidthOrHeight:1024,useWebWorker:!0},t=await n(s,e);a.push(t)}catch(r){a.push(s)}S(e=>({...e,images:[...e.images,...a]}))},accept:"image/*",ref:B})]})}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PNG, JPG up to 20MB"}),k&&a.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:["Total: ",W.length+A.images.length]})]})}),A.images.length>0&&a.jsxs("div",{className:"mt-3",children:[a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"New Images:"}),a.jsx("div",{className:"grid grid-cols-3 gap-2",children:A.images.map((e,t)=>a.jsxs("div",{className:"relative h-16 sm:h-20 bg-gray-100 dark:bg-gray-800 rounded overflow-hidden group",children:[a.jsx("img",{src:URL.createObjectURL(e),alt:"preview",className:"w-full h-full object-cover"}),a.jsx("button",{type:"button",onClick:()=>(e=>{S(t=>({...t,images:t.images.filter((t,a)=>a!==e)}))})(t),className:"absolute top-0 right-0 bg-red-500 text-white p-1 rounded-bl opacity-0 group-hover:opacity-100 transition-opacity",children:a.jsx(x,{size:12})})]},t))})]})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-3 border-t border-gray-200 dark:border-gray-700",children:[a.jsx("button",{type:"button",onClick:()=>N(!1),className:"px-3 py-1.5 sm:px-4 sm:py-2 border rounded text-xs sm:text-sm text-gray-700 dark:text-gray-200 border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800",children:"Cancel"}),a.jsx("button",{type:"submit",className:"px-3 py-1.5 sm:px-4 sm:py-2 bg-[var(--primary-color)] text-white rounded text-xs sm:text-sm hover:opacity-90",children:k?"Update":"Post"})]})]})]})}),O&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-90 backdrop-blur-sm",onClick:()=>R(null),children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-y-auto flex flex-col md:flex-row overflow-hidden",onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{className:"w-full md:w-2/3 bg-black flex items-center justify-center relative min-h-[300px] md:min-h-[600px] overflow-hidden",children:[a.jsx("style",{children:"\n                                @keyframes slideInRight {\n                                    from { transform: translateX(100%); opacity: 0; }\n                                    to { transform: translateX(0); opacity: 1; }\n                                }\n                                @keyframes slideInLeft {\n                                    from { transform: translateX(-100%); opacity: 0; }\n                                    to { transform: translateX(0); opacity: 1; }\n                                }\n                                .animate-slide-in-right { animation: slideInRight 0.3s ease-out forwards; }\n                                .animate-slide-in-left { animation: slideInLeft 0.3s ease-out forwards; }\n                             "}),(()=>{const e=y(O),t=e.length>0?e[$]:null;return a.jsxs(a.Fragment,{children:[t?a.jsx("img",{src:t,alt:O.title,className:"max-w-full max-h-full object-contain "+("right"===P?"animate-slide-in-right":"animate-slide-in-left")},$):a.jsx("div",{className:"text-gray-500",children:"No image available"}),e.length>1&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:t=>{t.stopPropagation(),I("left"),setTimeout(()=>{T(t=>(t-1+e.length)%e.length)},0)},className:"absolute left-4 top-1/2 -translate-y-1/2 bg-white bg-opacity-20 hover:bg-opacity-50 text-white rounded-full p-2 transition-all z-10",children:a.jsx(h,{size:32})}),a.jsx("button",{onClick:t=>{t.stopPropagation(),I("right"),setTimeout(()=>{T(t=>(t+1)%e.length)},0)},className:"absolute right-4 top-1/2 -translate-y-1/2 bg-white bg-opacity-20 hover:bg-opacity-50 text-white rounded-full p-2 transition-all z-10",children:a.jsx(p,{size:32})}),a.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black bg-opacity-50 text-white px-3 py-1 rounded-full text-sm z-10",children:[$+1," / ",e.length]})]})]})})()]}),a.jsxs("div",{className:"w-full md:w-1/3 flex flex-col h-full bg-white",children:[a.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[a.jsx("h3",{className:"text-xl font-bold text-gray-900 pr-4 truncate",children:O.title}),a.jsx("button",{onClick:()=>R(null),className:"text-gray-500 hover:text-red-500 transition-colors p-1 rounded-full hover:bg-gray-100",children:a.jsx(x,{size:24})})]}),a.jsxs("div",{className:"p-6 overflow-y-auto flex-1",children:[a.jsxs("div",{className:"flex items-center text-gray-500 text-sm mb-4 bg-gray-50 p-2 rounded inline-block",children:[a.jsx(o,{size:16,className:"mr-2"}),a.jsx("span",{className:"font-medium",children:O.date})]}),a.jsx("div",{className:"prose max-w-none text-gray-800 whitespace-pre-wrap leading-relaxed",children:O.description})]})]})]})}),a.jsxs("div",{className:"mt-6 bg-[var(--primary-color)] text-white rounded-lg p-4 shadow-md",children:[a.jsxs("div",{className:"flex items-center mb-3 border-b border-white/20 pb-1",children:[a.jsx(u,{size:18,className:"text-yellow-400 mr-2"}),a.jsx("span",{className:"font-semibold text-sm uppercase tracking-wide",children:"Quick Actions"})]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[a.jsx(i,{to:"/admin/data-analysis",className:"flex items-center justify-center px-3 py-2 rounded bg-white/10 hover:bg-white/20 text-xs md:text-sm",children:"Data Analysis"}),a.jsx(i,{to:"/admin/grading",className:"flex items-center justify-center px-3 py-2 rounded bg-white/10 hover:bg-white/20 text-xs md:text-sm",children:"Grading"}),a.jsx(i,{to:"/admin/activities",className:"flex items-center justify-center px-3 py-2 rounded bg-white/20 text-xs md:text-sm",children:"Activities"}),a.jsx(i,{to:"/admin/messages",className:"flex items-center justify-center px-3 py-2 rounded bg-white/10 hover:bg-white/20 text-xs md:text-sm",children:"Messages"})]})]})]})};export{b as default};
