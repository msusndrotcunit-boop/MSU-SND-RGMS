import{u as e,j as a}from"./index-CxXeNUtR.js";import{u as s,r as t}from"./vendor-react-BJYbxeCs.js";import{a as l}from"./vendor-utils-qHW_S61q.js";import{b as i}from"./vendor-media-Cvam96dz.js";import{r,G as n,L as d,aw as o,aa as c,j as m}from"./vendor-ui-Cf-65S3f.js";const x=()=>{const x=s(),{logout:u,user:h,login:p}=e(),[g,b]=t.useState(!1),[f,j]=t.useState(!0),[N,v]=t.useState(""),[y,_]=t.useState("profile"),[w,k]=t.useState(!1),[C,z]=t.useState(""),[S,q]=t.useState({rank:"",firstName:"",middleName:"",lastName:"",suffixName:"",afpsn:"",birthdate:"",birthplace:"",age:"",height:"",weight:"",blood_type:"",address:"",civil_status:"",nationality:"",gender:"",language_spoken:"",combat_boots_size:"",uniform_size:"",bullcap_size:"",email:"",contactNumber:"",facebook_link:"",rotc_unit:"",mobilization_center:"",profile_pic:""});t.useEffect(()=>{L()},[]);const L=async()=>{try{const e=(await l.get("/api/staff/me")).data;q(a=>({...a,rank:e.rank||"",firstName:e.first_name||"",middleName:e.middle_name||"",lastName:e.last_name||"",suffixName:e.suffix_name||"",email:e.email||"",contactNumber:e.contact_number||"",profile_pic:e.profile_pic||"",afpsn:e.afpsn||"",birthdate:e.birthdate||"",birthplace:e.birthplace||"",age:e.age||"",height:e.height||"",weight:e.weight||"",blood_type:e.blood_type||"",address:e.address||"",civil_status:e.civil_status||"",nationality:e.nationality||"",gender:e.gender||"",language_spoken:e.language_spoken||"",combat_boots_size:e.combat_boots_size||"",uniform_size:e.uniform_size||"",bullcap_size:e.bullcap_size||"",facebook_link:e.facebook_link||"",rotc_unit:e.rotc_unit||"",mobilization_center:e.mobilization_center||""})),e.is_profile_completed&&(k(!0),_("qr"),P(e))}catch(e){v("Failed to fetch profile data.")}finally{j(!1)}},P=async e=>{const a=JSON.stringify({id:e.id,name:`${e.rank} ${e.first_name} ${e.last_name}`,afpsn:e.afpsn,role:"training_staff"});try{const e=await i.toDataURL(a);z(e)}catch(s){}},M=e=>{const{name:a,value:s}=e.target;q(e=>({...e,[a]:s}))};return f?a.jsx("div",{className:"flex justify-center items-center min-h-screen",children:"Loading..."}):a.jsx("div",{className:"min-h-screen bg-gray-100 py-6 px-4",children:a.jsxs("div",{className:"max-w-6xl mx-auto bg-white rounded-lg shadow-xl overflow-hidden",children:[a.jsxs("div",{className:"bg-green-900 p-6 text-white flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[a.jsx(r,{size:28}),"Staff Profile Completion"]}),a.jsx("p",{className:"text-green-200 mt-1",children:w?"Profile Completed. Your QR Code is ready.":"Please complete your profile to access the system."})]}),a.jsxs("button",{onClick:()=>{u(),x("/login")},className:"text-green-200 hover:text-white flex items-center gap-1 text-sm bg-green-800 py-2 px-4 rounded",children:[a.jsx(n,{size:16})," Logout"]})]}),a.jsxs("div",{className:"flex border-b",children:[a.jsxs("button",{className:"flex-1 py-4 font-semibold text-center flex justify-center items-center gap-2 "+("profile"===y?"border-b-4 border-green-700 text-green-800 bg-green-50":"text-gray-500"),onClick:()=>!w&&_("profile"),disabled:w,children:[w?a.jsx(d,{size:18}):a.jsx(r,{size:18}),"Profile Information"]}),a.jsxs("button",{className:"flex-1 py-4 font-semibold text-center flex justify-center items-center gap-2 "+("qr"===y?"border-b-4 border-green-700 text-green-800 bg-green-50":"text-gray-500"),onClick:()=>w&&_("qr"),disabled:!w,children:[a.jsx(o,{size:18}),"QR Code Generation"]})]}),a.jsxs("div",{className:"p-8",children:["profile"===y&&a.jsxs("form",{onSubmit:async e=>{var a,s;e.preventDefault(),v(""),b(!0);try{await l.put("/api/staff/profile",S);alert("Profile updated successfully!");const e={...h,isProfileCompleted:!0};p(e),k(!0),_("qr"),L()}catch(t){v((null==(s=null==(a=t.response)?void 0:a.data)?void 0:s.message)||"Update failed")}finally{b(!1)}},className:"animate-fade-in",children:[N&&a.jsx("div",{className:"mb-6 bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded",role:"alert",children:a.jsx("p",{children:N})}),a.jsxs("div",{className:"mb-8 flex flex-col items-center",children:[a.jsx("div",{className:"w-32 h-32 rounded-full border-4 border-green-100 overflow-hidden bg-gray-200 mb-4 shadow-lg relative group",children:S.profile_pic?a.jsx("img",{src:S.profile_pic,alt:"Profile",className:"w-full h-full object-cover"}):a.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:a.jsx(r,{size:48})})}),a.jsxs("label",{className:"cursor-pointer bg-green-700 text-white py-2 px-4 rounded-md hover:bg-green-800 transition flex items-center gap-2 text-sm",children:[a.jsx(c,{size:16})," Upload Picture",a.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:async e=>{const a=e.target.files[0];if(a){if(a.size>5242880)return void alert("File is too large. Max 5MB.");const e=new FileReader;e.onloadend=()=>{q(a=>({...a,profile_pic:e.result}))},e.readAsDataURL(a)}}})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"font-bold text-lg border-b pb-2 text-green-800",children:"Identity"}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Rank"}),a.jsxs("select",{name:"rank",value:S.rank,onChange:M,className:"w-full p-2 border rounded",required:!0,children:[a.jsx("option",{value:"",children:"Select Rank"}),["Pvt","PFC","Cpl","Sgt","SSg","TSg","MSg","2LT","1LT","CPT","MAJ","LTC","COL","BGEN","MGEN","LTGEN","GEN"].map(e=>a.jsx("option",{value:e,children:e},e))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"AFPSN"}),a.jsx("input",{type:"text",name:"afpsn",value:S.afpsn,onChange:M,className:"w-full p-2 border rounded",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"First Name"}),a.jsx("input",{type:"text",name:"firstName",value:S.firstName,onChange:M,className:"w-full p-2 border rounded",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Middle Name"}),a.jsx("input",{type:"text",name:"middleName",value:S.middleName,onChange:M,className:"w-full p-2 border rounded"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Last Name"}),a.jsx("input",{type:"text",name:"lastName",value:S.lastName,onChange:M,className:"w-full p-2 border rounded",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Suffix"}),a.jsx("input",{type:"text",name:"suffixName",value:S.suffixName,onChange:M,className:"w-full p-2 border rounded"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"font-bold text-lg border-b pb-2 text-green-800",children:"Demographics"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Birthdate"}),a.jsx("input",{type:"date",name:"birthdate",value:S.birthdate,onChange:M,className:"w-full p-2 border rounded",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Age"}),a.jsx("input",{type:"number",name:"age",value:S.age,onChange:M,className:"w-full p-2 border rounded",readOnly:!0})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Birthplace"}),a.jsx("input",{type:"text",name:"birthplace",value:S.birthplace,onChange:M,className:"w-full p-2 border rounded",required:!0})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Height (cm)"}),a.jsx("input",{type:"text",name:"height",value:S.height,onChange:M,className:"w-full p-2 border rounded",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Weight (kg)"}),a.jsx("input",{type:"text",name:"weight",value:S.weight,onChange:M,className:"w-full p-2 border rounded",required:!0})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Blood Type"}),a.jsx("input",{type:"text",name:"blood_type",value:S.blood_type,onChange:M,className:"w-full p-2 border rounded"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Gender"}),a.jsxs("select",{name:"gender",value:S.gender,onChange:M,className:"w-full p-2 border rounded",required:!0,children:[a.jsx("option",{value:"",children:"Select"}),a.jsx("option",{value:"Male",children:"Male"}),a.jsx("option",{value:"Female",children:"Female"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Civil Status"}),a.jsxs("select",{name:"civil_status",value:S.civil_status,onChange:M,className:"w-full p-2 border rounded",required:!0,children:[a.jsx("option",{value:"",children:"Select"}),a.jsx("option",{value:"Single",children:"Single"}),a.jsx("option",{value:"Married",children:"Married"}),a.jsx("option",{value:"Widowed",children:"Widowed"}),a.jsx("option",{value:"Separated",children:"Separated"})]})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"font-bold text-lg border-b pb-2 text-green-800",children:"Logistics & Contact"}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Address"}),a.jsx("textarea",{name:"address",value:S.address,onChange:M,className:"w-full p-2 border rounded",rows:"2",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nationality"}),a.jsx("input",{type:"text",name:"nationality",value:S.nationality,onChange:M,className:"w-full p-2 border rounded",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Language Spoken"}),a.jsx("input",{type:"text",name:"language_spoken",value:S.language_spoken,onChange:M,className:"w-full p-2 border rounded"})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Boots"}),a.jsx("input",{type:"text",name:"combat_boots_size",value:S.combat_boots_size,onChange:M,className:"w-full p-2 border rounded"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Uniform"}),a.jsx("input",{type:"text",name:"uniform_size",value:S.uniform_size,onChange:M,className:"w-full p-2 border rounded"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Bullcap"}),a.jsx("input",{type:"text",name:"bullcap_size",value:S.bullcap_size,onChange:M,className:"w-full p-2 border rounded"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Contact Info"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsx("input",{type:"email",name:"email",value:S.email,onChange:M,placeholder:"Email",className:"w-full p-2 border rounded",required:!0}),a.jsx("input",{type:"text",name:"contactNumber",value:S.contactNumber,onChange:M,placeholder:"Mobile No.",className:"w-full p-2 border rounded",required:!0})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Facebook Link"}),a.jsx("input",{type:"text",name:"facebook_link",value:S.facebook_link,onChange:M,className:"w-full p-2 border rounded"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"ROTC Unit"}),a.jsx("input",{type:"text",name:"rotc_unit",value:S.rotc_unit,onChange:M,className:"w-full p-2 border rounded",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Mobilization Center"}),a.jsx("input",{type:"text",name:"mobilization_center",value:S.mobilization_center,onChange:M,className:"w-full p-2 border rounded",required:!0})]})]})]}),a.jsx("div",{className:"mt-8 flex justify-end",children:a.jsx("button",{type:"submit",disabled:g,className:"bg-green-700 text-white py-3 px-8 rounded-md hover:bg-green-800 shadow-lg flex items-center gap-2 font-bold",children:g?"Saving...":a.jsxs(a.Fragment,{children:[a.jsx(m,{size:20})," Save Profile & Generate QR"]})})})]}),"qr"===y&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-10 animate-fade-in",children:[a.jsx("h2",{className:"text-2xl font-bold text-green-900 mb-6",children:"Your Digital ID"}),a.jsx("div",{className:"bg-white p-6 rounded-lg shadow-2xl border-4 border-green-800",children:C?a.jsx("img",{src:C,alt:"Staff QR Code",className:"w-64 h-64"}):a.jsx("div",{className:"w-64 h-64 flex items-center justify-center text-gray-400",children:"Generating..."})}),a.jsx("p",{className:"mt-6 text-gray-600 max-w-md text-center",children:"Present this QR code to the admin for attendance scanning. You can access this code anytime from your dashboard."}),a.jsx("button",{onClick:()=>x("/staff/dashboard"),className:"mt-8 bg-green-700 text-white py-2 px-6 rounded hover:bg-green-800",children:"Go to Dashboard"})]})]})]})})};export{x as default};
