import{g as e,c as t,j as s}from"./index-CxXeNUtR.js";import{r as a,L as r}from"./vendor-react-BJYbxeCs.js";import{a as i}from"./vendor-utils-qHW_S61q.js";import{aa as l,X as n,ai as d,ag as c,a7 as o,K as m,N as x,D as p,J as u,C as h,y as b,B as g,aj as f,ak as j,j as y,a3 as N,T as v}from"./vendor-ui-Cf-65S3f.js";const w=()=>{const[w,S]=a.useState([]),[k,C]=a.useState(!0),[_,A]=a.useState(null),[T,E]=a.useState("proficiency"),[P,D]=a.useState(""),[I,z]=a.useState(!1),[M,L]=a.useState({examType:"prelim",pointsPerItem:1,correctAnswers:""}),[R,G]=a.useState(null),F=a.useRef(null),$=a.useRef(null),[O,U]=a.useState(!1),[B,W]=a.useState(!1),[K,H]=a.useState(null),[q,X]=a.useState(null),[Y,J]=a.useState(""),[Q,V]=a.useState([]),[Z,ee]=a.useState({type:"merit",points:0,reason:""}),[te,se]=a.useState(!1),[ae,re]=a.useState([]),[ie,le]=a.useState({prelimScore:0,midtermScore:0,finalScore:0}),[ne,de]=a.useState(!1),[ce,oe]=a.useState(!1),[me,xe]=a.useState([]),[pe,ue]=a.useState([]),[he,be]=a.useState(!1);a.useEffect(()=>{je()},[]),a.useEffect(()=>{I&&_&&J(_.id)},[I,_]),a.useEffect(()=>{_&&le({prelimScore:_.prelim_score||0,midtermScore:_.midterm_score||0,finalScore:_.final_score||0})},[_]);const ge=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});F.current&&(F.current.srcObject=e,U(!0),H(null),X(null))}catch(e){alert("Failed to access camera. Please check permissions.")}},fe=()=>{F.current&&F.current.srcObject&&(F.current.srcObject.getTracks().forEach(e=>e.stop()),U(!1))};a.useEffect(()=>(I||fe(),()=>fe()),[I]);const je=async(s=!1)=>{try{if(!s){const t=await e("admin","cadets_list");if(t){let e=t,s=0;if(t.data&&t.timestamp?(e=t.data,s=t.timestamp):Array.isArray(t)&&(e=t),Array.isArray(e)){const t=e.filter(e=>e.is_profile_completed);if(S(t),C(!1),s&&Date.now()-s<3e4)return}}}const a=await i.get("/api/admin/cadets"),r=a.data.filter(e=>e.is_profile_completed);if(S(r),await t("admin","cadets_list",{data:a.data,timestamp:Date.now()}),C(!1),_){const e=a.data.find(e=>e.id===_.id);e&&(A(e),le({prelimScore:e.prelim_score??0,midtermScore:e.midterm_score??0,finalScore:e.final_score??0}))}}catch(a){C(!1)}},ye=async e=>{try{const t=await i.get(`/api/admin/merit-logs/${e}`);V(t.data)}catch(t){}},Ne=w.filter(e=>(e.last_name.toLowerCase().includes(P.toLowerCase())||e.first_name.toLowerCase().includes(P.toLowerCase())||e.student_id.includes(P))&&e.is_profile_completed);if(k)return s.jsx("div",{className:"p-10 text-center",children:"Loading..."});const ve=async(e,t)=>{const s=new FormData;return t.forEach(e=>s.append("files",e)),i.post(e,s,{headers:{"Content-Type":"multipart/form-data"}})};return s.jsxs("div",{className:"relative h-full",children:[s.jsx("div",{className:"flex items-center justify-between mb-3",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{onClick:()=>de(!0),className:"px-3 py-2 bg-blue-600 text-white rounded hover:opacity-90 flex items-center gap-2",children:[s.jsx(l,{size:16})," Import Exam Scores"]}),s.jsxs("button",{onClick:()=>oe(!0),className:"px-3 py-2 bg-green-600 text-white rounded hover:opacity-90 flex items-center gap-2",children:[s.jsx(l,{size:16})," Import Merit/Demerit"]})]})}),ne&&s.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"bg-white rounded-lg w-full max-w-md p-6 space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h3",{className:"font-bold text-lg",children:"Import Examination Scores"}),s.jsx("button",{onClick:()=>de(!1),children:s.jsx(n,{size:20})})]}),s.jsx("input",{type:"file",multiple:!0,accept:".csv,.xlsx,.xls,.json",onChange:e=>xe(Array.from(e.target.files||[]))}),s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx("button",{onClick:()=>de(!1),className:"px-3 py-2 border rounded",children:"Cancel"}),s.jsx("button",{disabled:he||0===me.length,onClick:async()=>{if(0!==me.length){be(!0);try{await ve("/api/integration/grades/import",me),de(!1),xe([]),je(!0),alert("Examination scores imported")}catch(e){alert("Import failed")}finally{be(!1)}}},className:"px-3 py-2 bg-blue-600 text-white rounded",children:he?"Uploading...":"Upload"})]})]})}),ce&&s.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"bg-white rounded-lg w-full max-w-md p-6 space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h3",{className:"font-bold text-lg",children:"Import Merit/Demerit"}),s.jsx("button",{onClick:()=>oe(!1),children:s.jsx(n,{size:20})})]}),s.jsx("input",{type:"file",multiple:!0,accept:".csv,.xlsx,.xls,.json",onChange:e=>ue(Array.from(e.target.files||[]))}),s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx("button",{onClick:()=>oe(!1),className:"px-3 py-2 border rounded",children:"Cancel"}),s.jsx("button",{disabled:he||0===pe.length,onClick:async()=>{if(0!==pe.length){be(!0);try{await ve("/api/integration/ledger/import",pe),oe(!1),ue([]),je(!0),alert("Merit/Demerit records imported")}catch(e){alert("Import failed")}finally{be(!1)}}},className:"px-3 py-2 bg-green-600 text-white rounded",children:he?"Uploading...":"Upload"})]})]})}),I&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-0 md:p-4 backdrop-blur-sm",children:s.jsxs("div",{className:"bg-white rounded-none md:rounded-xl w-full max-w-6xl h-full md:h-[90vh] flex flex-col md:flex-row overflow-hidden shadow-2xl",children:[s.jsxs("div",{className:"w-full md:w-1/3 border-r bg-gray-50 flex flex-col h-1/3 md:h-auto overflow-y-auto",children:[s.jsxs("div",{className:"p-4 border-b bg-white flex justify-between items-center sticky top-0 z-10",children:[s.jsxs("h3",{className:"font-bold text-lg flex items-center text-gray-800",children:[s.jsx(d,{className:"mr-2 text-blue-600",size:20}),"Smart Exam Scanner"]}),s.jsx("button",{onClick:()=>z(!1),className:"text-gray-400 hover:text-gray-700 transition",children:s.jsx(n,{size:24})})]}),s.jsxs("div",{className:"p-4 space-y-6",children:[s.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-blue-100",children:[s.jsx("label",{className:"block text-xs font-bold text-blue-800 uppercase tracking-wider mb-2",children:"Target Cadet"}),s.jsxs("select",{value:Y,onChange:e=>J(e.target.value),className:"w-full border p-2 rounded focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"",children:"-- Select Cadet --"}),Ne.map(e=>s.jsxs("option",{value:e.id,children:[e.last_name,", ",e.first_name," (",e.student_id,")"]},e.id))]}),!Y&&s.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Please select a cadet before scanning"})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:[s.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2",children:"Configuration"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Exam Type"}),s.jsxs("select",{className:"w-full border p-2 rounded",value:M.examType,onChange:e=>L({...M,examType:e.target.value}),children:[s.jsx("option",{value:"prelim",children:"Prelim Exam"}),s.jsx("option",{value:"midterm",children:"Midterm Exam"}),s.jsx("option",{value:"final",children:"Final Exam"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Points per Item"}),s.jsx("input",{type:"number",min:"1",className:"w-full border p-2 rounded",value:M.pointsPerItem,onChange:e=>L({...M,pointsPerItem:Number(e.target.value)})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Key (Length determines items)"}),s.jsx("input",{className:"w-full border p-2 rounded font-mono uppercase",placeholder:"ANSWERKEY...",value:M.correctAnswers,onChange:e=>L({...M,correctAnswers:e.target.value})}),s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Total Items: ",M.correctAnswers.length||100]})]})]})]}),R&&s.jsxs("div",{className:"bg-green-50 border border-green-200 p-5 rounded-lg shadow-sm",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-xs font-bold text-green-700 uppercase tracking-wide bg-green-100 px-2 py-0.5 rounded",children:"Saved"}),s.jsx("span",{className:"text-xs text-green-600",children:(new Date).toLocaleTimeString()})]}),s.jsx("div",{className:"font-bold text-lg text-gray-900 mb-1",children:R.name}),s.jsxs("div",{className:"flex justify-between items-end border-t border-green-200 pt-2 mt-2",children:[s.jsx("div",{className:"text-sm text-gray-600 capitalize",children:R.type}),s.jsxs("div",{className:"text-2xl font-bold text-green-700",children:[R.score," ",s.jsx("span",{className:"text-sm font-normal text-green-600",children:"pts"})]})]})]})]})]}),s.jsxs("div",{className:"w-full md:w-2/3 bg-gray-900 flex flex-col relative flex-1 md:flex-auto",children:[s.jsxs("div",{className:"flex-1 relative flex items-center justify-center bg-black overflow-hidden",children:[s.jsx("video",{ref:F,autoPlay:!0,playsInline:!0,muted:!0,className:"absolute inset-0 w-full h-full object-cover "+(K?"hidden":"")}),s.jsx("canvas",{ref:$,className:"hidden"}),K&&s.jsx("img",{src:K,alt:"Captured Exam",className:"absolute inset-0 w-full h-full object-contain bg-black"}),!K&&O&&s.jsxs("div",{className:"absolute inset-0 border-2 border-blue-500 opacity-50 pointer-events-none m-8 rounded-lg",children:[s.jsx("div",{className:"absolute top-0 left-0 w-4 h-4 border-t-4 border-l-4 border-blue-500 -mt-1 -ml-1"}),s.jsx("div",{className:"absolute top-0 right-0 w-4 h-4 border-t-4 border-r-4 border-blue-500 -mt-1 -mr-1"}),s.jsx("div",{className:"absolute bottom-0 left-0 w-4 h-4 border-b-4 border-l-4 border-blue-500 -mb-1 -ml-1"}),s.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 border-b-4 border-r-4 border-blue-500 -mb-1 -mr-1"}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsx("p",{className:"text-white text-opacity-80 font-bold bg-black bg-opacity-50 px-3 py-1 rounded",children:"Align Exam Paper"})})]}),!O&&!K&&s.jsxs("div",{className:"text-center",children:[s.jsxs("button",{onClick:ge,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-full flex items-center gap-2 transition transform hover:scale-105",children:[s.jsx(c,{size:24})," Activate Smart Camera"]}),s.jsx("p",{className:"text-gray-500 mt-4 text-sm",children:"Camera permission required"})]})]}),s.jsxs("div",{className:"p-4 bg-gray-800 border-t border-gray-700 flex justify-between items-center",children:[O&&!B&&s.jsxs("div",{className:"flex gap-4 w-full justify-center",children:[s.jsxs("button",{onClick:async()=>{if(F.current&&$.current){W(!0),X(null);try{const t=F.current,s=$.current;s.width=t.videoWidth,s.height=t.videoHeight;s.getContext("2d").drawImage(t,0,0,s.width,s.height);const a=s.toDataURL("image/png");if(H(a),fe(),!window.Tesseract)throw new Error("OCR Library not loaded. Check internet connection.");const{data:{text:r}}=await window.Tesseract.recognize(a,"eng"),l=["NAME","SCORE","GRADE","TEST","EXAM","SUBJECT","DATE","SECTION","NO.","ITEM","TOTAL"],n=r.toUpperCase(),d=l.some(e=>n.includes(e)),c=/\b(\d+)\s*[.\-):]+\s*([A-E])\b/gi,o=[...r.matchAll(c)];if(!d&&o.length<3)return alert("Non-test paper detected.\n\nPlease scan a valid test paper containing:\n- Headers (Name, Test, Score)\n- Or answers formatted as '1. A', '2. B'"),void W(!1);const m=M.correctAnswers.toUpperCase().replace(/[^A-Z]/g,"");let x=0,p=0,u=m.length||0,h=0;if(m.length>0){if(0===o.length){const e=n.replace(/[^A-E]/g,"");if(!(e.length>=.5*m.length))return alert("Could not detect answer format.\nPlease format answers as '1. A', '2. B' for best results."),void W(!1);{const t=Math.min(e.length,m.length);for(let s=0;s<t;s++)e[s]===m[s]?x++:p++;m.length>t&&(p+=m.length-t)}}else{const e={};o.forEach(t=>{const s=parseInt(t[1],10),a=t[2].toUpperCase();e[s]=a});for(let t=0;t<m.length;t++){const s=t+1,a=m[t],r=e[s];r&&r===a?x++:p++}}u=m.length}else{const e=r.match(/(?:Score|Grade|Total)\s*[:\-\s]?\s*(\d+)(?:\s*\/\s*(\d+))?/i),t=r.match(/(\d+)\s*\/\s*(\d+)/);if(e)x=parseInt(e[1],10),u=e[2]?parseInt(e[2],10):100,p=u-x;else{if(!t)return alert("No Answer Key provided and no Score found on paper.\n\nPlease either:\n1. Enter an Answer Key (e.g. ABCD)\n2. Or write 'Score: XX/YY' on the paper."),void W(!1);x=parseInt(t[1],10),u=parseInt(t[2],10),p=u-x}}if(h=x*(Number(M.pointsPerItem)||1),X({totalItems:u,wrongCount:p,score:h,examType:M.examType,rawText:r}),Y){const t=w.find(e=>e.id===Number(Y));if(t)try{const e="prelim"===M.examType?"prelimScore":"midterm"===M.examType?"midtermScore":"finalScore",s={prelimScore:t.prelim_score||0,midtermScore:t.midterm_score||0,finalScore:t.final_score||0,attendancePresent:t.attendance_present||0,meritPoints:t.merit_points||0,demeritPoints:t.demerit_points||0,status:t.grade_status||"active",[e]:Number(h)};await i.put(`/api/admin/grades/${t.id}`,s),G({name:`${t.last_name}, ${t.first_name}`,score:h,type:M.examType}),je(!0)}catch(e){alert("Auto-save failed. Please try syncing manually.")}}else alert("Score calculated but NOT saved: Please select a cadet first.")}catch(t){alert("Analysis Failed: "+t.message)}finally{W(!1)}}},className:"bg-white text-gray-900 px-8 py-3 rounded-full font-bold flex items-center gap-2 hover:bg-gray-200 transition",children:[s.jsx("div",{className:"w-4 h-4 bg-red-500 rounded-full animate-pulse"}),"Capture & Grade"]}),s.jsx("button",{onClick:fe,className:"text-gray-400 hover:text-white px-4 py-2",children:"Cancel"})]}),B&&s.jsxs("div",{className:"w-full text-center text-white flex items-center justify-center gap-3",children:[s.jsx(o,{className:"animate-spin"}),s.jsx("span",{children:"Analyzing Answers & Computing Score..."})]}),q&&s.jsxs("div",{className:"w-full flex items-center justify-between animate-slide-up",children:[s.jsxs("div",{className:"text-white",children:[s.jsx("div",{className:"text-xs text-gray-400 uppercase",children:"Computed Score"}),s.jsxs("div",{className:"text-2xl font-bold text-green-400",children:[q.score," / ",q.totalItems*M.pointsPerItem]}),s.jsxs("div",{className:"text-xs text-red-400 flex items-center gap-1",children:[s.jsx(m,{size:12})," ",q.wrongCount," Wrong Answers Detected"]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>{H(null),X(null),ge()},className:"px-4 py-2 text-gray-300 hover:text-white",children:"Retake"}),s.jsxs("button",{onClick:async()=>{if(!q||!Y)return void alert("Please select a cadet first.");const e=w.find(e=>e.id===Number(Y));if(e)try{const t="prelim"===q.examType?"prelimScore":"midterm"===q.examType?"midtermScore":"finalScore",s={prelimScore:e.prelim_score||0,midtermScore:e.midterm_score||0,finalScore:e.final_score||0,attendancePresent:e.attendance_present||0,meritPoints:e.merit_points||0,demeritPoints:e.demerit_points||0,status:e.grade_status||"active",[t]:Number(q.score)};await i.put(`/api/admin/grades/${e.id}`,s),G({name:`${e.last_name}, ${e.first_name}`,score:q.score,type:q.examType}),je(!0),X(null),H(null),ge()}catch(t){alert("Failed to update grade.")}},className:"bg-[var(--primary-color)] hover:opacity-90 text-white px-6 py-2 rounded font-bold flex items-center gap-2",children:[s.jsx(x,{size:18})," Sync to Gradebook"]})]})]})]})]})]})}),s.jsxs("div",{className:"flex h-full flex-col md:flex-row gap-6",children:[s.jsxs("div",{className:"w-full md:w-1/3 bg-white dark:bg-gray-900 rounded shadow flex flex-col "+(_?"hidden md:flex":""),children:[s.jsxs("div",{className:"p-4 border-b",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100",children:"Grading Management"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>{const e=(new Date).toLocaleString(),t=Ne.length,s=[["Report,Grading List",`Generated,"${e}"`,""].join("\n"),[["Student ID","Last Name","First Name","Company","Platoon","Prelim","Midterm","Final","Subject Score","Merits","Demerits","Attendance Present","Attendance Score","Final Grade","Transmuted"].join(","),...Ne.map(e=>[e.student_id,`"${e.last_name}"`,`"${e.first_name}"`,e.company,e.platoon,e.prelim_score,e.midterm_score,e.final_score,e.subjectScore,e.merit_points,e.demerit_points,e.attendance_present,e.attendanceScore,e.finalGrade,e.transmutedGrade].join(","))].join("\n"),["",'Prepared By,"Wilmer B Montejo","SSg (Inf) PA â€¢ Admin NCO"','Certified Correct,"INDIHRA D TAWANTAWAN","LTC (RES) PA â€¢ Commandant"',`Total Records,${t}`].join("\n")].join("\n"),a=new Blob([s],{type:"text/csv"}),r=window.URL.createObjectURL(a),i=document.createElement("a");i.href=r,i.download=`grading_list_${(new Date).toISOString().split("T")[0]}.csv`,i.click(),window.URL.revokeObjectURL(r)},className:"bg-[var(--primary-color)] text-white px-3 py-1.5 rounded hover:opacity-90 flex items-center text-sm transition",title:"Export CSV",children:s.jsx(p,{size:16})}),s.jsxs("button",{onClick:()=>z(!0),className:"bg-gray-800 text-white px-3 py-1.5 rounded hover:bg-black flex items-center text-sm transition",children:[s.jsx(d,{size:16,className:"mr-1.5"})," Scan Exams"]})]})]}),s.jsxs("div",{className:"relative",children:[s.jsx(u,{className:"absolute left-3 top-3 text-gray-400",size:18}),s.jsx("input",{className:"w-full pl-10 p-2 border rounded bg-gray-50 dark:bg-gray-800 dark:text-gray-100 dark:border-gray-700",placeholder:"Search cadets...",value:P,onChange:e=>D(e.target.value)})]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto",children:Ne.map(e=>s.jsx("div",{onClick:()=>(e=>{A(e),le({prelimScore:e.prelim_score??0,midtermScore:e.midterm_score??0,finalScore:e.final_score??0}),"merit"===T&&ye(e.id)})(e),className:"p-4 border-b cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition "+((null==_?void 0:_.id)===e.id?"bg-[var(--primary-color)]/10 border-l-4 border-[var(--primary-color)]":""),children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"font-bold text-gray-800 dark:text-gray-100",children:[e.last_name,", ",e.first_name]}),s.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.company,"/",e.platoon," â€¢ ",e.student_id]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-xs text-gray-500",children:"Final"}),s.jsx("div",{className:"font-bold "+((e.finalGrade||0)>=75?"text-green-600":"text-red-600"),children:(e.finalGrade||0).toFixed(2)})]})]})},e.id))})]}),s.jsx("div",{className:"w-full md:w-2/3 bg-white dark:bg-gray-900 rounded shadow flex flex-col "+(_?"":"hidden md:flex justify-center items-center text-gray-400 dark:text-gray-500"),children:_?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"p-6 border-b flex justify-between items-start bg-gray-50 dark:bg-gray-800 dark:border-gray-700",children:[s.jsxs("div",{children:[s.jsxs("button",{onClick:()=>A(null),className:"md:hidden text-gray-500 mb-2 flex items-center",children:[s.jsx(b,{className:"rotate-90 mr-1",size:16})," Back to List"]}),s.jsxs("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:[_.rank," ",_.last_name,", ",_.first_name]}),s.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:[_.student_id," â€¢ ",_.company,"/",_.platoon]})]}),s.jsxs("div",{className:"text-right bg-white dark:bg-gray-900 p-3 rounded shadow-sm border dark:border-gray-700",children:[s.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:"Final Grade"}),s.jsx("div",{className:"text-3xl font-bold "+((_.finalGrade||0)>=75?"text-green-600":"text-red-600"),children:(_.finalGrade||0).toFixed(2)}),s.jsxs("div",{className:"text-xs text-gray-400",children:["Transmuted: ",_.transmutedGrade||"N/A"]})]})]}),s.jsxs("div",{className:"flex border-b",children:[s.jsxs("button",{onClick:()=>E("proficiency"),className:"flex-1 py-4 text-center font-medium flex justify-center items-center space-x-2 border-b-2 transition "+("proficiency"===T?"border-green-600 text-green-700 bg-green-50":"border-transparent text-gray-500 hover:text-gray-700"),children:[s.jsx(g,{size:18}),s.jsx("span",{children:"Subject Proficiency"})]}),s.jsxs("button",{onClick:()=>{E("merit"),ye(_.id)},className:"flex-1 py-4 text-center font-medium flex justify-center items-center space-x-2 border-b-2 transition "+("merit"===T?"border-purple-600 text-purple-700 bg-purple-50":"border-transparent text-gray-500 hover:text-gray-700"),children:[s.jsx(f,{size:18}),s.jsx("span",{children:"Merit / Demerit"})]}),s.jsxs("button",{onClick:()=>E("attendance"),className:"flex-1 py-4 text-center font-medium flex justify-center items-center space-x-2 border-b-2 transition "+("attendance"===T?"border-blue-600 text-blue-700 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700"),children:[s.jsx(j,{size:18}),s.jsx("span",{children:"Attendance"})]})]}),s.jsxs("div",{className:"flex-1 p-6 overflow-y-auto bg-gray-50",children:["proficiency"===T&&s.jsx("div",{className:"max-w-none mx-0 w-full",children:s.jsxs("div",{className:"bg-white p-6 rounded shadow-sm border mb-6",children:[s.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center text-gray-800",children:[s.jsx(g,{className:"mr-2 text-green-600",size:20}),"Examination Scores (40%)"]}),s.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{const e={...ie,attendancePresent:_.attendance_present,meritPoints:_.merit_points,demeritPoints:_.demerit_points,status:_.grade_status};await i.put(`/api/admin/grades/${_.id}`,e),alert("Scores updated successfully"),await t("admin","cadets_list",null),je(!0)}catch(s){alert("Error updating scores")}},className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Prelim Score (0-100)"}),s.jsx("input",{type:"number",min:"0",max:"100",className:"w-full border p-2 rounded focus:ring-2 focus:ring-[var(--primary-color)] focus:outline-none dark:bg-gray-900 dark:border-gray-700 dark:text-gray-100",value:ie.prelimScore,onChange:e=>le({...ie,prelimScore:Number(e.target.value)})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Midterm Score (0-100)"}),s.jsx("input",{type:"number",min:"0",max:"100",className:"w-full border p-2 rounded focus:ring-2 focus:ring-[var(--primary-color)] focus:outline-none dark:bg-gray-900 dark:border-gray-700 dark:text-gray-100",value:ie.midtermScore,onChange:e=>le({...ie,midtermScore:Number(e.target.value)})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Final Score (0-100)"}),s.jsx("input",{type:"number",min:"0",max:"100",className:"w-full border p-2 rounded focus:ring-2 focus:ring-[var(--primary-color)] focus:outline-none dark:bg-gray-900 dark:border-gray-700 dark:text-gray-100",value:ie.finalScore,onChange:e=>le({...ie,finalScore:Number(e.target.value)})})]}),s.jsx("div",{className:"pt-4",children:s.jsxs("button",{type:"submit",className:"w-full bg-[var(--primary-color)] text-white py-2 rounded hover:opacity-90 flex justify-center items-center",children:[s.jsx(y,{size:18,className:"mr-2"}),"Save Scores"]})})]})]})}),"merit"===T&&s.jsx("div",{className:"max-w-none mx-0 w-full",children:s.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[s.jsxs("div",{className:"w-full md:w-1/3",children:[s.jsxs("div",{className:"bg-white p-4 rounded shadow-sm border mb-4",children:[s.jsx("h3",{className:"font-bold mb-3 text-gray-800",children:"Add Record"}),s.jsxs("form",{onSubmit:async e=>{var s,a;e.preventDefault();try{await i.post("/api/admin/merit-logs",{cadetId:_.id,...Z});ye(_.id),await t("admin","cadets_list",null),je(!0),ee({type:"merit",points:0,reason:""})}catch(r){alert("Error adding log: "+((null==(a=null==(s=r.response)?void 0:s.data)?void 0:a.message)||r.message))}},className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Type"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{type:"button",onClick:()=>ee({...Z,type:"merit"}),className:"flex-1 py-2 text-sm rounded border "+("merit"===Z.type?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-600"),children:"Merit"}),s.jsx("button",{type:"button",onClick:()=>ee({...Z,type:"demerit"}),className:"flex-1 py-2 text-sm rounded border "+("demerit"===Z.type?"bg-red-600 text-white border-red-600":"bg-white text-gray-600"),children:"Demerit"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Points"}),s.jsx("input",{type:"number",min:"1",required:!0,className:"w-full border p-2 rounded",value:Z.points,onChange:e=>ee({...Z,points:Number(e.target.value)})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Reason"}),s.jsx("input",{type:"text",required:!0,className:"w-full border p-2 rounded",value:Z.reason,onChange:e=>ee({...Z,reason:e.target.value})})]}),s.jsx("button",{type:"submit",className:"w-full bg-gray-800 text-white py-2 rounded hover:bg-gray-700 text-sm",children:"Add Entry"})]})]}),s.jsxs("div",{className:"bg-white p-4 rounded shadow-sm border",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("h3",{className:"font-bold text-gray-800",children:"Summary"}),s.jsxs("button",{onClick:async()=>{var e,s;if(confirm("Sync lifetime merit points from merit/demerit logs?\n\nThis will recalculate lifetime merits for all cadets based on their merit logs.")){se(!0);try{const e=await i.post("/api/admin/sync-lifetime-merits");alert(`Sync complete!\n\n${e.data.syncedCount} cadets updated\nTotal cadets: ${e.data.totalCadets}`),await t("admin","cadets_list",null),je(!0)}catch(a){alert("Failed to sync lifetime merits: "+((null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.message)||a.message))}finally{se(!1)}}},disabled:te,className:"text-xs bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white px-2 py-1 rounded flex items-center gap-1 transition",title:"Sync lifetime merit points from logs",children:[s.jsx(N,{size:12}),te?"Syncing...":"Sync"]})]}),s.jsxs("div",{className:"flex justify-between items-center py-2 border-b",children:[s.jsx("span",{className:"text-gray-600",children:"Total Merits"}),s.jsx("span",{className:"font-bold text-blue-600",children:_.merit_points})]}),s.jsxs("div",{className:"flex justify-between items-center py-2 border-b",children:[s.jsx("span",{className:"text-gray-600",children:"Total Demerits"}),s.jsx("span",{className:"font-bold text-red-600",children:_.demerit_points})]}),s.jsxs("div",{className:"flex justify-between items-center py-2 border-b",children:[s.jsx("span",{className:"font-bold text-gray-800",children:"Net Score"}),s.jsx("span",{className:"font-bold text-xl",children:Math.min(100,Math.max(0,100+_.merit_points-_.demerit_points))})]}),(()=>{const e=100+_.merit_points-_.demerit_points,t=100===Math.min(100,Math.max(0,e))&&e>=100,a=Math.max(0,e-100),r=_.lifetime_merit_points||_.merit_points||0;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex justify-between items-center py-2 pt-3 bg-purple-50 px-2 rounded mt-2",children:[s.jsxs("span",{className:"text-sm text-purple-700 flex items-center gap-1",children:[s.jsx("span",{children:"ðŸ†"}),"Lifetime Merit"]}),s.jsx("span",{className:"font-bold text-purple-700",children:r})]}),t&&a>0&&s.jsxs("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs",children:[s.jsx("p",{className:"text-yellow-800 font-semibold",children:"âš ï¸ At Ceiling"}),s.jsxs("p",{className:"text-yellow-700 mt-1",children:[a," merit points beyond 100 ceiling"]})]})]})})()]})]}),s.jsx("div",{className:"w-full md:w-2/3",children:s.jsx("div",{className:"bg-white rounded shadow-sm border overflow-hidden",children:s.jsxs("table",{className:"w-full text-sm text-left",children:[s.jsx("thead",{className:"bg-gray-100 text-gray-600 uppercase text-xs",children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-3",children:"Date"}),s.jsx("th",{className:"p-3",children:"Type"}),s.jsx("th",{className:"p-3",children:"Reason"}),s.jsx("th",{className:"p-3 text-right",children:"Pts"}),s.jsx("th",{className:"p-3"})]})}),s.jsx("tbody",{children:0===Q.length?s.jsx("tr",{children:s.jsx("td",{colSpan:"5",className:"p-4 text-center text-gray-500",children:"No records found"})}):Q.map(e=>s.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[s.jsx("td",{className:"p-3",children:new Date(e.created_at).toLocaleDateString()}),s.jsx("td",{className:"p-3",children:s.jsx("span",{className:"px-2 py-1 rounded text-xs font-bold "+("merit"===e.type?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"),children:e.type.toUpperCase()})}),s.jsx("td",{className:"p-3",children:e.reason}),s.jsx("td",{className:"p-3 text-right font-bold",children:e.points}),s.jsx("td",{className:"p-3 text-right",children:s.jsx("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this record?"))try{await i.delete(`/api/admin/merit-logs/${e}`),ye(_.id),await t("admin","cadets_list",null),je(!0)}catch(s){alert("Error deleting log")}})(e.id),className:"text-red-400 hover:text-red-600",children:s.jsx(v,{size:16})})})]},e.id))})]})})})]})}),"attendance"===T&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"bg-white p-4 rounded shadow-sm border text-center",children:[s.jsx("div",{className:"text-gray-500 text-sm uppercase",children:"Present"}),s.jsx("div",{className:"text-3xl font-bold text-green-600",children:_.attendance_present})]}),s.jsxs("div",{className:"bg-white p-4 rounded shadow-sm border text-center",children:[s.jsx("div",{className:"text-gray-500 text-sm uppercase",children:"Total Days"}),s.jsx("div",{className:"text-3xl font-bold text-gray-800",children:_.totalTrainingDays||0})]}),s.jsxs("div",{className:"bg-white p-4 rounded shadow-sm border text-center",children:[s.jsx("div",{className:"text-gray-500 text-sm uppercase",children:"Attendance Score"}),s.jsx("div",{className:"text-3xl font-bold text-blue-600",children:(_.attendanceScore||0).toFixed(2)})]})]}),s.jsxs("div",{className:"bg-white rounded shadow-sm border overflow-hidden",children:[s.jsx("h3",{className:"font-bold p-4 border-b bg-gray-50",children:"Attendance History"}),s.jsxs("div",{className:"p-8 text-center text-gray-500 italic",children:["Detailed attendance logs are managed in the Attendance Module.",s.jsx("br",{}),s.jsx("button",{onClick:()=>window.location.href="/admin/attendance",className:"mt-2 text-blue-600 hover:underline",children:"Go to Attendance Module"})]})]})]})]})]}):s.jsxs("div",{className:"text-center",children:[s.jsx(h,{size:48,className:"mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"Select a cadet to manage grades"})]})})]}),s.jsxs("div",{className:"mt-4 bg-green-900 text-white rounded-lg p-4 shadow-md",children:[s.jsxs("div",{className:"flex items-center mb-3 border-b border-green-700 pb-1",children:[s.jsx(N,{size:18,className:"text-yellow-400 mr-2"}),s.jsx("span",{className:"font-semibold text-sm uppercase tracking-wide",children:"Quick Actions"})]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[s.jsx(r,{to:"/admin/data-analysis",className:"flex items-center justify-center px-3 py-2 rounded bg-white/10 hover:bg-white/20 text-xs md:text-sm",children:"Data Analysis"}),s.jsx(r,{to:"/admin/grading",className:"flex items-center justify-center px-3 py-2 rounded bg-white/20 text-xs md:text-sm",children:"Grading"}),s.jsx(r,{to:"/admin/activities",className:"flex items-center justify-center px-3 py-2 rounded bg-white/10 hover:bg-white/20 text-xs md:text-sm",children:"Activities"}),s.jsx(r,{to:"/admin/messages",className:"flex items-center justify-center px-3 py-2 rounded bg-white/10 hover:bg-white/20 text-xs md:text-sm",children:"Messages"})]})]})]})};export{w as default};
